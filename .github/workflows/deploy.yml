name: deploy

on:
  push:
    branches: [ master ] # master åˆ†æ”¯æœ‰ push æ—¶è§¦å‘
    paths-ignore: # ä¸‹åˆ—æ–‡ä»¶çš„å˜æ›´ä¸è§¦å‘éƒ¨ç½²ï¼Œå¯ä»¥è‡ªè¡Œæ·»åŠ 
      - README.md

jobs:
#  check-branch:
#    runs-on: ubuntu-latest
#    steps:
#      # åˆ é™¤ç¼“å­˜çš„è¿œç¨‹åˆ†æ”¯
#      - name: Check if branch exists
#        uses: actions/checkout@v2
#        with:
#          ref: refs/heads/gh-pages
#          fetch-depth: 0
#          token: ${{ secrets.DEPLOY }} # secret å
#      - run: |
#            if [ -z "$(git rev-parse --verify gh-pages)" ]; then
#              echo "Branch not exists and Run build."
#            else
#              git config --global user.email "${{ secrets.MY_USER_EMAIL }}"
#              git config --global user.name "${{ secrets.MY_USER_NAME }}"
#              git push origin --delete gh-pages
#            fi

  deploy:
    if: github.repository == 'dompling/boxjs.react'
    runs-on: ubuntu-latest
    steps:

      # ä¸‹è½½æºç 
      # è¿™ä¸€æ­¥å°±æ˜¯æ£€å‡ºä½ çš„ä»“åº“å¹¶ä¸‹è½½é‡Œé¢çš„ä»£ç åˆ°runnerä¸­,actions/checkout@v2æ˜¯å®˜æ–¹è‡ªå·±é€ çš„è½®å­ï¼Œç›´æ¥æ‹¿æ¥ç”¨å°±è¡Œ
      - name: Checkout
        uses: actions/checkout@v2

      # æ‰“åŒ…æ„å»º
      - name: Setup Node
        uses: actions/setup-node@master
        with:
          node-version: '16.x'

      - name: Cache node_modules
        id: cache-node-modules
        uses: actions/cache@v2
        with:
          path: node_modules
          key: ${{ runner.os }}-${{ matrix.node-version }}-nodeModules-${{ hashFiles('package-lock.json') }}-${{ hashFiles('package.json') }}
          restore-keys: |
            ${{ runner.os }}-${{ matrix.node-version }}-nodeModules-

      - name: Install dependencies ğŸ“¦ï¸
        if: steps.cache-node-modules.outputs.cache-hit != 'true'
        run: |
          npm install
          npm install -g yarn

      - run: yarn build # æ‰“åŒ…

      # éƒ¨ç½²åˆ° GitHub pages
      - name: Deploy
        uses: peaceiris/actions-gh-pages@v3 # ä½¿ç”¨éƒ¨ç½²åˆ° GitHub pages çš„ action
        with:
          publish_dir: ./dist # éƒ¨ç½²æ‰“åŒ…åçš„ dist ç›®å½•
          github_token: ${{ secrets.DEPLOY }} # secret å
          user_name: ${{ secrets.MY_USER_NAME }}
          user_email: ${{ secrets.MY_USER_EMAIL }}
          commit_message: è‡ªåŠ¨éƒ¨ç½² # éƒ¨ç½²æ—¶çš„ git æäº¤ä¿¡æ¯ï¼Œè‡ªç”±å¡«å†™