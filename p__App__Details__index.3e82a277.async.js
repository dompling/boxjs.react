"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[35],{32646:function(dn,je,n){n.d(je,{k:function(){return Y}});var Pe=n(97857),ge=n.n(Pe),Me=n(90948),X=n(45843),De=n(85893),Y=(0,Me.ZP)(function(de){return(0,De.jsx)(X.Z,ge()({focusVisibleClassName:".Mui-focusVisible",disableRipple:!0},de))})(function(de){var M=de.theme;return{width:42,height:26,padding:0,"& .MuiSwitch-switchBase":{padding:0,margin:2,transitionDuration:"300ms","&.Mui-checked":{transform:"translateX(16px)",color:"#fff","& + .MuiSwitch-track":{backgroundColor:M.palette.primary,opacity:1,border:0},"&.Mui-disabled + .MuiSwitch-track":{opacity:.5}},"&.Mui-focusVisible .MuiSwitch-thumb":{color:M.palette.primary,border:"6px solid #fff"},"&.Mui-disabled .MuiSwitch-thumb":{color:M.palette.mode==="light"?M.palette.grey[100]:M.palette.grey[600]},"&.Mui-disabled + .MuiSwitch-track":{opacity:M.palette.mode==="light"?.7:.3}},"& .MuiSwitch-thumb":{boxSizing:"border-box",width:22,height:22},"& .MuiSwitch-track":{borderRadius:26/2,backgroundColor:M.palette.mode==="light"?"#E9E9EA":"#39393D",opacity:1,transition:M.transitions.create(["background-color"],{duration:500})}}})},16961:function(dn,je,n){var Pe=n(52677),ge=n.n(Pe),Me=n(97857),X=n.n(Me),De=n(19632),Y=n.n(De),de=n(5574),M=n.n(de),ze=n(13769),a=n.n(ze),Oe=n(33525),ue=n(22148),Je=n(40625),He=n(42761),Qe=n(90089),_e=n(93946),Ge=n(42293),Xe=n(10155),Fe=n(78462),ne=n(97212),Ve=n(59334),Ye=n(15861),ie=n(83321),se=n(50657),ye=n(31425),B=n(50480),W=n(75438),we=n(36872),qe=n(72890),Ce=n(93109),re=n(67294),j=n(85893),en=["defaultValue"],D=(0,re.forwardRef)(function(e,nn){var rn=e.defaultValue,oe=a()(e,en),on=re.useState(!1),T=M()(on,2),tn=T[0],Ae=T[1],Ie=(0,re.useState)(rn),Ue=M()(Ie,2),ce=Ue[0],$=Ue[1],te=(0,re.useState)(""),ve=M()(te,2),A=ve[0],Be=ve[1],Te=(0,Ce.Z)(A,{wait:100}),ln=(0,ue.useModel)("@@initialState"),k=ln.initialState,w=[{id:"extra_data_key",name:"\u975E\u8BA2\u9605\u6570\u636E",_id:"extra_data_key@local",keys:(k==null?void 0:k.boxdata.usercfgs.gist_cache_key)||[],descs_html:[],author:"local",repo:"",icons:[]}].concat(Y()(((k==null?void 0:k.boxdata.sysapps)||[]).filter(function(x){return x.keys&&!!x.keys.length})));Object.values((k==null?void 0:k.boxdata.appSubCaches)||{}).forEach(function(x){w=[].concat(Y()(w),Y()(x.apps.filter(function(_){return _.keys&&!!_.keys.length})))}),w=w.filter(function(x){return x.name.indexOf(Te)>-1||!Te?!0:!!x.keys.find(function(_){return _.indexOf(Te)>-1})});var K=k==null?void 0:k.boxdata.datas;(0,re.useImperativeHandle)(nn,function(){return{value:ce}}),(0,re.useEffect)(function(){$(oe.value)},[oe.value]);var N=function(){Ae(!1),Be("")},be=function(_){var J;$(_),(J=oe.onChange)===null||J===void 0||J.call(oe,{target:{name:oe.name,value:_}})};return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(Qe.Z,X()(X()({},oe),{},{value:ce,onChange:function(_){be(_.target.value)},size:"small",type:"text",endAdornment:(0,j.jsx)(_e.Z,{size:"small","aria-label":oe.name,onClick:function(){Ae(!0)},children:(0,j.jsx)(Je.Z,{fontSize:"small",sx:{color:function(_){return _.palette.primary.main}}})})})),(0,j.jsxs)(se.Z,{open:tn,onClose:function(){return N()},sx:{mt:15,mb:15,"& .MuiDialog-paper":{width:"100%"}},children:[(0,j.jsx)(Ge.Z,{position:"static",sx:{background:function(_){return _.palette.primary.main}},children:(0,j.jsx)(Xe.Z,{children:(0,j.jsxs)(Oe.ol,{children:[(0,j.jsx)(Oe.el,{placeholder:"\u8BF7\u8F93\u5165\u5E94\u7528\u540D\u79F0\u6216\u7F13\u5B58Key",inputProps:{"aria-label":"search"},onChange:function(_){Be(_.target.value)}}),(0,j.jsx)(Oe.cB,{children:(0,j.jsx)(He.Z,{})})]})})}),(0,j.jsx)(Fe.Z,{subheader:(0,j.jsx)("li",{}),sx:{position:"relative",overflow:"auto",minHeight:300,"& ul":{padding:0}},children:(0,j.jsx)(qe.Z,{name:"radio-buttons-group",onChange:function(_,J){be(J)},children:w.length>0?w.map(function(x,_){var J,he,Re="".concat(x.id,"_").concat(x.author,"_").concat(_);return(0,j.jsxs)("li",{style:{width:"100%",boxSizing:"border-box"},children:[(0,j.jsxs)(W.Z,{sx:{borderBottom:"1px solid rgba(0, 0, 0, .125)",mt:0},children:[x==null?void 0:x.name,"\uFF08",x==null||(J=x.keys)===null||J===void 0?void 0:J.length,"\uFF09"]}),x==null||(he=x.keys)===null||he===void 0?void 0:he.map(function(le){return(0,j.jsx)(ne.ZP,{sx:{p:0,pl:3,pr:3},children:(0,j.jsx)(Ve.Z,{id:Re,primary:(0,j.jsx)(B.Z,{value:le,control:(0,j.jsx)(we.Z,{}),label:le,sx:{"& .MuiFormControlLabel-label":{width:"80%",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"noWrap"}}}),primaryTypographyProps:{noWrap:!0,variant:"caption",sx:{fontWeight:"bold"}},secondary:(0,j.jsx)(Ye.Z,{noWrap:!0,color:"grey",variant:"caption",component:"div",children:(ge()(K==null?void 0:K[le])==="object"&&(K!=null&&K[le])?JSON.stringify(K==null?void 0:K[le]):K==null?void 0:K[le])||"\u65E0\u6570\u636E"})})},"".concat(Re,"-").concat(le))})]},"section-".concat(Re))}):(0,j.jsx)(ne.ZP,{sx:{height:290,textAlign:"center"},children:(0,j.jsx)(Ve.Z,{primary:"\u672A\u627E\u5230\u76F8\u5173\u7ED3\u679C"})})})}),(0,j.jsxs)(ye.Z,{sx:{borderTop:"1px solid rgba(0, 0, 0, .125)"},children:[(0,j.jsx)(ie.Z,{color:"inherit",onClick:function(){return N()},children:"\u53D6\u6D88"}),(0,j.jsx)(ie.Z,{onClick:function(){return N()},autoFocus:!0,children:"\u786E\u5B9A"})]})]})]})});je.Z=D},71244:function(dn,je,n){n.r(je),n.d(je,{default:function(){return $n}});var Pe=n(9783),ge=n.n(Pe),Me=n(19632),X=n.n(Me),De=n(52677),Y=n.n(De),de=n(5574),M=n.n(de),ze=n(97857),a=n.n(ze),Oe=n(13769),ue=n.n(Oe),Je=n(49677),He=n.n(Je),Qe=n(32646),_e=n(33525),Ge=n(40625),Xe=n(42761),Fe=n(90089),ne=n(93946),Ve=n(42293),Ye=n(10155),ie=n(78462),se=n(97212),ye=n(59334),B=n(15861),W=n(83321),we=n(50657),qe=n(31425),Ce=n(50480),re=n(36872),j=n(72890),en=n(93109),D=n(67294),e=n(85893),nn=["defaultValue","items"],rn=(0,D.forwardRef)(function(c,r){var f=c.defaultValue,E=c.items,t=ue()(c,nn),u=D.useState(!1),d=M()(u,2),l=d[0],s=d[1],g=(0,D.useState)(f),v=M()(g,2),S=v[0],y=v[1],h=(0,D.useState)(""),O=M()(h,2),F=O[0],L=O[1],z=(0,en.Z)(F,{wait:100}),R=X()(E||[]);R=R.filter(function(C){return z?typeof C=="string"?C.indexOf(z)>-1||!z:C.key.indexOf(z)>-1||C.label.indexOf(z)>-1:!0}),(0,D.useImperativeHandle)(r,function(){return{value:S}}),(0,D.useEffect)(function(){y(t.value)},[t.value]);var ae=function(){s(!1),L("")},xe=function(b){var q;y(b),(q=t.onChange)===null||q===void 0||q.call(t,{target:{name:t.name,value:b}})};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Fe.Z,a()(a()({},t),{},{value:S,onChange:function(b){xe(b.target.value)},size:"small",type:"text",endAdornment:(0,e.jsx)(ne.Z,{size:"small","aria-label":t.name,onClick:function(){s(!0)},children:(0,e.jsx)(Ge.Z,{fontSize:"small",sx:{color:function(b){return b.palette.primary.main}}})})})),(0,e.jsxs)(we.Z,{open:l,onClose:function(){return ae()},sx:{mt:15,mb:15,"& .MuiDialog-paper":{width:"100%"}},children:[(0,e.jsx)(Ve.Z,{position:"static",sx:{background:function(b){return b.palette.primary.main}},children:(0,e.jsx)(Ye.Z,{children:(0,e.jsxs)(_e.ol,{children:[(0,e.jsx)(_e.el,{placeholder:"\u8BF7\u8F93\u5165",inputProps:{"aria-label":"search"},onChange:function(b){L(b.target.value)}}),(0,e.jsx)(_e.cB,{children:(0,e.jsx)(Xe.Z,{})})]})})}),(0,e.jsx)(ie.Z,{subheader:(0,e.jsx)("li",{}),sx:{position:"relative",overflow:"auto",minHeight:300,"& ul":{padding:0}},children:(0,e.jsx)(j.Z,{name:"radio-buttons-group",onChange:function(b,q){xe(q)},children:R.length>0?R.map(function(C){var b={label:"",key:""};return typeof C=="string"?(b.label=C,b.key=C):b=a()({},C),(0,e.jsx)(se.ZP,{sx:{p:0,pl:3,pr:3},children:(0,e.jsx)(ye.Z,{id:b.key,primary:(0,e.jsx)(Ce.Z,{value:b.key,control:(0,e.jsx)(re.Z,{}),label:b.label,sx:{"& .MuiFormControlLabel-label":{width:"80%",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"noWrap"}}}),primaryTypographyProps:{noWrap:!0,variant:"caption",sx:{fontWeight:"bold"}},secondary:typeof C!="string"&&(0,e.jsx)(B.Z,{noWrap:!0,color:"grey",variant:"caption",component:"div",children:b.key})})},b.key)}):(0,e.jsx)(se.ZP,{sx:{height:290,textAlign:"center"},children:(0,e.jsx)(ye.Z,{primary:"\u672A\u627E\u5230\u76F8\u5173\u7ED3\u679C"})})})}),(0,e.jsxs)(qe.Z,{sx:{borderTop:"1px solid rgba(0, 0, 0, .125)"},children:[(0,e.jsx)(W.Z,{color:"inherit",onClick:function(){return ae()},children:"\u53D6\u6D88"}),(0,e.jsx)(W.Z,{onClick:function(){return ae()},autoFocus:!0,children:"\u786E\u5B9A"})]})]})]})}),oe=rn,on=n(16961),T=n(22148),tn=n(60181),Ae=n(23508),Ie=n(3018),Ue=n(74423),ce=n(56815),$=n(94054),te=n(47312),ve=n(50135),A=n(51233),Be=n(40476),Te=n(69368),ln=n(10315),k=n(18972),w=n(98456),K=n(58826),N=n(87357),be=n(82280),x=n(38895),_=n(22797),J=n(20640),he=n.n(J),Re=n(96486),le=n.n(Re),hn=n(97458),mn=n(30780),V=n(87536),xn={add:"add___mHDQy",picker:"picker___ZxyLG"},fn=["text"],pn=["id"];function me(c){var r=c.text,f=ue()(c,fn),E=(0,Ue.Z)()||{},t=E.focused,u=D.useMemo(function(){return t?r:""},[t]);return(0,e.jsx)(hn.Z,{type:["top","bottom"],leaveReverse:!0,style:{minHeight:25},children:t?(0,e.jsx)(ce.Z,a()(a()({},f),{},{children:u}),r):null})}function an(c){var r={label:"",key:""};return typeof c=="string"?(r.label=c,r.key=c):r=c,r}var jn=(0,D.forwardRef)(function(c,r){var f=c.value,E=c.defaultValue,t=c.name,u=c.onChange,d=(0,D.useState)(E),l=M()(d,2),s=l[0],g=l[1],v={};return v.color=s,(0,D.useImperativeHandle)(r,function(){return{value:f}}),(0,D.useEffect)(function(){g(f)},[f]),(0,e.jsx)(mn.AI,a()(a()({},v),{},{className:xn.picker,onChangeComplete:function(y){g(y.hex),u==null||u({target:{name:t,value:y.hex}})}}))}),sn=function(r,f){r.name=(r.disabled?"\u{1F232} \u624B\u52A8\u586B\u5199-":"")+r.name;var E=r.id.replaceAll(".","~"),t={name:r.formName||E,control:f==null?void 0:f.control,rules:{pattern:r.pattern}};return(0,e.jsxs)(e.Fragment,{children:[(["text","number"].includes(r.type)||!r.type)&&(0,e.jsxs)($.Z,{size:"small",sx:{width:1},variant:"standard",children:[(0,e.jsx)(te.Z,{htmlFor:r.id,children:r.name}),(0,e.jsx)(V.Qr,a()(a()({},t),{},{render:function(d){var l=d.field,s=d.formState;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Fe.Z,a()({id:r.id,size:"small",type:r.type,disabled:r.disabled,placeholder:r.placeholder},l)),(0,e.jsx)(me,{text:r.desc,error:!!s.errors[l.name]})]})}}))]}),r.type==="textarea"&&!r.child&&(0,e.jsx)(V.Qr,a()(a()({},t),{},{render:function(d){var l=d.field,s=d.formState;return(0,e.jsx)(ve.Z,a()({fullWidth:!0,multiline:!0,id:r.id,size:"small",label:r.name,variant:"standard",rows:6,helperText:r.desc,disabled:r.disabled,placeholder:r.placeholder,error:!!s.errors[l.name]},l))}})),r.child&&(0,e.jsxs)($.Z,{size:"small",sx:{width:1},variant:"standard",children:[(0,e.jsx)(te.Z,{htmlFor:r.id,sx:{position:"unset",transform:"unset",mb:2},children:r.name}),(0,e.jsx)(gn,{name:t.name,form:f,setting:r}),(0,e.jsx)(me,{text:r.desc})]}),r.type==="boolean"&&(0,e.jsxs)(A.Z,{children:[(0,e.jsx)(V.Qr,a()(a()({},t),{},{render:function(d){var l=d.field;return(0,e.jsx)(Ce.Z,{label:r.name,control:(0,e.jsx)(Qe.k,{sx:{m:1},disabled:r.disabled,checked:l.value==="true"||l.value===!0,onChange:function(g){return l.onChange(g.target.checked)}})})}})),(0,e.jsx)(ce.Z,{sx:{minHeight:20},children:r.desc})]}),r.type==="checkboxes"&&(0,e.jsxs)($.Z,{component:"fieldset",variant:"standard",children:[(0,e.jsx)(Be.Z,{component:"legend",children:r.name}),(0,e.jsx)(V.Qr,a()(a()({},t),{},{render:function(d){var l,s=d.field,g=typeof s.value=="string",v=(g&&s.value?s.value.split(","):s.value)||[];return(0,e.jsx)(e.Fragment,{children:(l=r.items)===null||l===void 0?void 0:l.map(function(S){var y=an(S);return(0,e.jsx)(Ce.Z,{control:(0,e.jsx)(Te.Z,{checked:v==null?void 0:v.includes(y.key),onChange:function(O){var F=v;O.target.checked?F.push(y.key):F=F.filter(function(L){return L!=y.key}),s.onChange(g?F.join(","):F)}}),label:y.label,disabled:r.disabled},y.key)})})}})),(0,e.jsx)(ce.Z,{sx:{minHeight:20},children:r.desc})]}),["modalSelects","cacheKey","text","textarea","selects","boolean","radios","checkboxes","colorpicker","number"].indexOf(r.type)===-1&&(0,e.jsxs)($.Z,{size:"small",sx:{width:1},variant:"standard",children:[(0,e.jsx)(te.Z,{htmlFor:r.id,children:r.name}),(0,e.jsx)(V.Qr,a()(a()({},t),{},{render:function(d){var l=d.field,s=d.formState;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Fe.Z,a()({id:r.id,size:"small",type:r.type,disabled:r.disabled,placeholder:r.placeholder},l)),(0,e.jsx)(me,{text:r.desc,error:!!s.errors[l.name]})]})}}))]}),r.type==="radios"&&(0,e.jsxs)($.Z,{component:"fieldset",variant:"standard",children:[(0,e.jsx)(Be.Z,{component:"legend",children:r.name}),(0,e.jsx)(V.Qr,a()(a()({},t),{},{render:function(d){var l,s=d.field;return(0,e.jsx)(j.Z,a()(a()({},s),{},{children:(l=r.items)===null||l===void 0?void 0:l.map(function(g){var v=an(g);return(0,e.jsx)(Ce.Z,{value:v.key,label:v.label,control:(0,e.jsx)(re.Z,{}),disabled:r.disabled},v.key)})}))}})),(0,e.jsx)(ce.Z,{sx:{minHeight:20},children:r.desc})]}),r.type==="selects"&&(0,e.jsxs)($.Z,{sx:{m:1},variant:"standard",children:[(0,e.jsx)(te.Z,{htmlFor:r.id,children:r.name}),(0,e.jsx)(V.Qr,a()(a()({},t),{},{render:function(d){var l,s=d.field;return(0,e.jsx)(ln.Z,a()(a()({placeholder:"\u8BF7\u9009\u62E9",sx:{width:"100%"},MenuProps:{sx:{maxHeight:300}}},s),{},{children:(l=r.items)===null||l===void 0?void 0:l.map(function(g,v){var S=an(g);return(0,e.jsx)(k.Z,{value:S.key,children:S.label},"".concat(S.key,"_").concat(v))})}))}})),(0,e.jsx)(me,{text:r.desc})]}),r.type==="modalSelects"&&(0,e.jsx)($.Z,{sx:{m:1},variant:"standard",children:(0,e.jsx)(V.Qr,a()(a()({},t),{},{render:function(d){var l=d.field,s=d.formState;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(te.Z,{htmlFor:r.id,shrink:!!l.value,children:r.name}),(0,e.jsx)(oe,a()(a()({inputProps:{shrink:!0}},l),{},{items:r.items})),(0,e.jsx)(me,{text:r.desc,error:!!s.errors[l.name]})]})}}))}),r.type==="cacheKey"&&(0,e.jsx)($.Z,{size:"small",sx:{width:1},variant:"standard",children:(0,e.jsx)(V.Qr,a()(a()({},t),{},{render:function(d){var l=d.field,s=d.formState;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(te.Z,{htmlFor:r.id,shrink:!!l.value,children:r.name}),(0,e.jsx)(on.Z,a()({},l)),(0,e.jsx)(me,{text:r.desc,error:!!s.errors[l.name]})]})}}))}),r.type==="colorpicker"&&(0,e.jsxs)($.Z,{size:"small",sx:{width:1},variant:"standard",children:[(0,e.jsx)(te.Z,{htmlFor:r.id,sx:{position:"unset",transform:"unset",mb:2},children:r.name}),(0,e.jsx)(V.Qr,a()(a()({},t),{},{render:function(d){var l=d.field;return(0,e.jsx)(jn,{value:l.value,onChange:function(g){return l.onChange(g.target.value)}})}})),(0,e.jsx)(me,{text:r.desc})]})]})},gn=function(r){var f,E,t=r.setting,u=r.form,d=r.name,l=(0,V.Dq)({name:d,control:u==null?void 0:u.control}),s=l.fields,g=l.append,v=l.remove,S=(0,T.useModel)("api"),y=S.fetchRunScript,h=(0,T.useRequest)(function(Z){return(0,T.request)(Z)},{manual:!0,formatResult:function(o){return o}}),O=(0,V.cI)(),F=(0,T.useModel)("alert"),L=(0,D.useState)(""),z=M()(L,2),R=z[0],ae=z[1],xe=(0,D.useState)(!1),C=M()(xe,2),b=C[0],q=C[1],Le=(0,D.useState)(!1),ee=M()(Le,2),m=ee[0],P=ee[1],Ze=(0,D.useState)(!1),U=M()(Ze,2),fe=U[0],ke=U[1],$e=function(o){return function(i,p){P(p?o:!1)}},Se=0,H=[];s.forEach(function(Z){var o=Z.id,i=ue()(Z,pn),p=Object.keys(i),I=p.length;I>Se&&(Se=I,H=p)});var Ke={};H=[].concat(X()(H),X()((t==null||(f=t.child)===null||f===void 0?void 0:f.map(function(Z){return Ke[Z.id]=Z,Z.id}))||[])),H=le().uniq(H);var Q=s.filter(function(Z,o){return b?!0:o<4}),pe=function(){ke(!1),O.reset()},Ee=function(){var o;return t!=null&&t.childScripts?(0,e.jsx)(ie.Z,{disablePadding:!0,children:t==null||(o=t.childScripts)===null||o===void 0?void 0:o.map(function(i,p){return(0,e.jsx)(se.ZP,{sx:{padding:0,mb:2},secondaryAction:(0,e.jsxs)(ne.Z,{edge:"end",sx:{mr:-3.5,position:"relative"},"aria-label":i.name,onClick:function(){var G="const $arguments=".concat(JSON.stringify((u==null?void 0:u.control._formValues[d][p])||O.getValues()),`;
`);h.run(i.script).then(function(Ne){y.run({script:"".concat(G).concat(Ne)})})},children:[(0,e.jsx)(Ie.Z,{}),y.loading&&(0,e.jsx)(w.Z,{size:24,sx:{position:"absolute",top:"50%",left:"50%",marginTop:"-12px",marginLeft:"-12px"}})]}),children:(0,e.jsx)(B.Z,{variant:"body2",sx:{fontWeight:500},component:"span",onClick:function(){T.history.push("/code?url=".concat(i.script))},children:"".concat(p+1,".").concat(i.name)})},i.name)})}):null};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(K.ZP,{anchor:"bottom",open:fe,onClose:function(){return pe()},children:[(0,e.jsx)(N.Z,{sx:{pt:1,pb:1,borderBottom:1,borderColor:"divider",boxShadow:function(o){return o.shadows[2]},position:"fixed",width:"100%",bgcolor:"inherit",zIndex:99},children:(0,e.jsxs)(A.Z,{direction:"row",alignItems:"center",children:[(0,e.jsxs)(B.Z,{sx:{flexGrow:1,pl:1},children:[R,"-",t==null?void 0:t.name]}),(0,e.jsx)(W.Z,{color:"primary",onClick:function(){var o=O.getValues();if(o["*JSON*"])try{return u==null||u.setValue(d,JSON.parse(o["*JSON*"])),pe()}catch(i){return F.alert({open:!0,message:"JSON \u683C\u5F0F\u9519\u8BEF",type:"error"})}Object.keys(o).forEach(function(i){o[i]===void 0&&(o[i]="")}),g(o),pe()},children:"\u4FDD\u5B58"})]})}),(0,e.jsxs)(A.Z,{sx:{pt:10,pl:2,pr:2,height:"60vh",maxHeight:"60vh"},children:[Ee(),H&&R==="\u65B0\u589E"?(E=H)===null||E===void 0?void 0:E.map(function(Z,o){var i=Ke[Z]||{id:"[".concat(o,"].").concat(Z),name:Z,type:"text"};return(0,e.jsx)(D.Fragment,{children:sn(i,O)},i.id)}):(0,e.jsx)(ve.Z,a()({fullWidth:!0,multiline:!0,size:"small",minRows:10,variant:"standard",placeholder:"\u8BF7\u8F93\u5165 JSON \u6570\u7EC4",helperText:(0,e.jsx)("pre",{children:` JSON \u683C\u5F0F\u6570\u7EC4\u793A\u4F8B\u503C
`.concat(JSON.stringify([{key:1,val:1},{key:2,val:2}],null," "))})},O.register("*JSON*")))]})]}),Q.map(function(Z,o){var i,p=t!=null&&t.primary?t==null?void 0:t.primary.map(function(G){return Z[G]||o+1}):[t==null?void 0:t.name,o+1],I="".concat(t==null?void 0:t.id,"-").concat(o);return!b&&o>4?null:(0,e.jsxs)(be.Z,{expanded:m===I,onChange:$e(I),children:[(0,e.jsx)(x.Z,{id:I,expandIcon:(0,e.jsx)(Ae.Z,{}),"aria-controls":"".concat(I,"-content"),children:(0,e.jsx)(B.Z,{variant:"body2",children:p==null?void 0:p.join("-")})}),(0,e.jsxs)(_.Z,{children:[Ee(),m===I&&((i=H)===null||i===void 0?void 0:i.map(function(G){var Ne=Ke[G]||{type:"text",id:G,name:G};return(0,e.jsx)(D.Fragment,{children:sn(a()(a()({},Ne),{},{formName:"".concat(d,".").concat(o,".").concat(G)}),u)},Ne.id)})),(0,e.jsx)(W.Z,{size:"small",color:"error",sx:{width:"100%"},variant:"contained",onClick:function(){v(o),P(!1)},children:"\u5220\u9664"})]})]},I)}),s.length>5&&(0,e.jsx)(be.Z,{expanded:!1,onClick:function(){q(!b)},children:(0,e.jsx)(x.Z,{children:(0,e.jsx)(B.Z,{color:"primary",variant:"body2",sx:{width:1,display:"flex",alignItems:"center",justifyContent:"center"},children:b?(0,e.jsxs)(e.Fragment,{children:["\u6536\u8D77 ",(0,e.jsx)(tn.Z,{})]}):(0,e.jsxs)(e.Fragment,{children:["\u66F4\u591A ",(0,e.jsx)(Ae.Z,{})]})})})}),(0,e.jsx)(be.Z,{expanded:!1,children:(0,e.jsx)(x.Z,{children:(0,e.jsxs)(A.Z,{spacing:1,sx:{width:1},direction:"row",alignItems:"center",justifyContent:"center",children:[(0,e.jsx)(W.Z,{color:"error",onClick:function(){u==null||u.setValue(d,[])},children:"\u6E05\u7A7A"}),(0,e.jsx)(W.Z,{color:"primary",onClick:function(){O.reset(),ae("\u65B0\u589E"),ke(!0)},children:"\u65B0\u589E"}),(0,e.jsx)(W.Z,{color:"warning",onClick:function(){he()(JSON.stringify(s)),F.alert({open:!0,message:"\u590D\u5236\u6210\u529F",type:"success"})},children:"\u590D\u5236"}),(0,e.jsx)(W.Z,{color:"info",onClick:function(){O.reset(),ae("\u5BFC\u5165"),ke(!0)},children:"\u5BFC\u5165"})]})})})]})};function yn(c){var r=c.form,f=c.setting;return f?sn(a()({},f),r):null}var Cn=yn,bn=n(92461),Zn=n(67720),Sn=function(r){var f=r.formConfig,E=(0,T.useModel)("@@initialState"),t=E.initialState,u=(0,T.useModel)("api"),d=u.fetchSave,l={},s=function(){f.forEach(function(S){var y=t==null?void 0:t.boxdata.datas[S.id],h=y===""||y===void 0?S.val:y;h===null&&(h=void 0);try{l[S.id.replaceAll(".","~")]=S.child?JSON.parse("".concat(h||"[]")):h}catch(O){console.log(O)}})};s();var g=(0,V.cI)({defaultValues:l});return(0,D.useEffect)(function(){l={},s(),g.reset(l)},[t==null?void 0:t.boxdata]),(0,e.jsxs)(bn.Z,{form:g,noValidate:!0,onSubmit:function(S){var y=[];Object.keys(S).forEach(function(h){var O=h.replaceAll("~","."),F=t==null?void 0:t.boxdata.datas[O],L=S[h];if(Y()(L)==="object"&&typeof F=="string")try{L=JSON.stringify(L,null," ")}catch(z){L=S[h].join(",")}else typeof S[h]=="boolean"&&(L="".concat(S[h]));y.push({key:O,val:L})}),d.run(y)},autoComplete:"off",children:[(0,e.jsx)(A.Z,{sx:{pl:2,pr:2},spacing:1,children:f.map(function(v){return typeof v.items=="string"&&(v.items=(t==null?void 0:t.boxdata.datas[v.items])||[]),(0,e.jsx)(Cn,{form:g,setting:v,itemValue:t==null?void 0:t.boxdata.datas},v.id)})}),(0,e.jsx)(Zn.Z,{}),(0,e.jsx)(A.Z,{p:"5px",spacing:2,justifyContent:"flex-end",children:(0,e.jsx)(W.Z,{type:"submit",variant:"text",sx:{width:"max-content",marginLeft:"auto"},children:"\u4FDD\u5B58"})})]})},En=Sn,Pn=n(31085),Mn=["appName"],Dn=function(r){var f,E,t=(0,T.useModel)("api"),u=t.fetchSave,d=(0,V.cI)();return(0,D.useEffect)(function(){if(r.open){var l,s,g={};(l=r.data)===null||l===void 0||l.datas.forEach(function(v){g[v.key.replace(".","*")]=Y()(v.val)==="object"?JSON.stringify(v.val):v.val}),d.reset(a()({appName:(s=r.data)===null||s===void 0?void 0:s.name},g))}},[r.open]),(0,e.jsx)(Pn.Z,{fullScreen:!0,open:!!r.open,title:"".concat(((f=r.data)===null||f===void 0?void 0:f.name)||"\u4F1A\u8BDD\u4FEE\u6539"),onClose:function(){var s;(s=r.onClose)===null||s===void 0||s.call(r)},form:d,loading:u.loading,onSubmit:function(s){var g=s.appName,v=ue()(s,Mn),S=[];Object.keys(v).forEach(function(y){S.push({key:y.replace("*","."),val:v[y]})}),u.run([{key:"@chavy_boxjs_sessions.".concat(r.sessionIndex),val:a()(a()({},r.data),{},{datas:S,name:g})}]).then(function(){var y;(y=r.onClose)===null||y===void 0||y.call(r)})},children:(0,e.jsxs)(A.Z,{spacing:2,children:[(0,e.jsx)(ve.Z,a()({fullWidth:!0,size:"small",label:"\u4F1A\u8BDD\u540D\u79F0",variant:"standard",placeholder:"\u4F1A\u8BDD\u540D\u79F0",InputLabelProps:{shrink:!0}},d.register("appName"))),(E=r.data)===null||E===void 0?void 0:E.datas.map(function(l){return(0,e.jsx)(ve.Z,a()({fullWidth:!0,size:"small",label:l.key,variant:"standard",placeholder:"\u8BF7\u8F93\u5165",InputLabelProps:{shrink:!0}},d.register(l.key.replace(".","*"))),l.key)})]})})},On=Dn,_n=n(5554),Fn=n(84424),An=n(50594),In=n(43329),un=n(90948),Bn=n(14948),We=n(90629),Tn=n(74815),Rn=n(90852),Wn=n(40044),Ln=n(8379),cn=n.n(Ln),kn=["children","value","index"],vn=(0,un.ZP)(Bn.Z)(function(c){var r=c.theme;return{right:"unset","& .MuiBadge-badge":{transform:"scale(1) translate(2px, -50%)",color:r.palette.common.white}}}),Kn=(0,un.ZP)(B.Z)(function(c){return He()(c),{right:"unset",whiteSpace:"pre-wrap",wordBreak:"break-word","& h4,h1,h2,h3,p":{padding:0,margin:0}}});function Vn(c){var r=c.children,f=c.value,E=c.index,t=ue()(c,kn);return(0,e.jsx)("div",a()(a()({role:"tabpanel",hidden:f!==E,id:"simple-tabpanel-".concat(E),"aria-labelledby":"simple-tab-".concat(E)},t),{},{children:f===E&&(0,e.jsx)(N.Z,{sx:{p:3},children:r})}))}function Un(c){return{id:"simple-tab-".concat(c),"aria-controls":"simple-tabpanel-".concat(c)}}function $n(){var c,r,f,E,t,u,d,l,s,g,v,S,y=(0,T.useModel)("@@initialState"),h=y.initialState,O=(0,T.useParams)(),F=O==null?void 0:O.id,L=(0,D.useState)(),z=M()(L,2),R=z[0],ae=z[1],xe=(0,T.useModel)("api"),C=xe.fetchSave,b=xe.fetchRunScript,q=(0,T.useModel)("alert"),Le=h==null?void 0:h.boxdata.datas,ee=(h==null?void 0:h.boxdata.sessions)||[],m=h==null?void 0:h.apps.find(function(o){return o.id===F}),P=ee==null?void 0:ee.filter(function(o){return(o==null?void 0:o.appId)==="".concat(F)}),Ze=!1,U={id:cn()(),appId:F,enable:!0,appName:m==null?void 0:m.name,createTime:new Date,datas:m==null?void 0:m.keys.map(function(o){return{key:o,val:Le==null?void 0:Le[o]}})};P&&!(P!=null&&P.length)&&m!==null&&m!==void 0&&m.keys&&F&&(Ze=!0);var fe=(P==null?void 0:P.findIndex(function(o){return(o==null?void 0:o.id)===(h==null?void 0:h.boxdata.curSessions["".concat(F)])}))||0;fe>-1&&(U.name=P==null?void 0:P[fe].name);var ke=D.useState(fe>-1?fe:0),$e=M()(ke,2),Se=$e[0],H=$e[1],Ke=function(i){H(i)},Q=P[Se],pe={};Q==null||Q.datas.forEach(function(o){pe[o.key]=o.val});var Ee=h==null?void 0:h.boxdata.usercfgs,Z=ee==null?void 0:ee.findIndex(function(o){return(o==null?void 0:o.id)===(Q==null?void 0:Q.id)});return m?(0,e.jsxs)(A.Z,{spacing:1,p:1,children:[(0,e.jsx)(On,{data:R==null||(c=R.update)===null||c===void 0?void 0:c.data,open:R==null||(r=R.update)===null||r===void 0?void 0:r.open,value:R==null||(f=R.update)===null||f===void 0?void 0:f.val,sessionIndex:Z,onClose:function(){return ae(function(i){if(i)return i.update={open:!1},a()({},i)})}}),(0,e.jsxs)(A.Z,{direction:"row",justifyContent:m.script?"space-between":"flex-start",alignItems:"center",children:[(0,e.jsx)(B.Z,{variant:"h6",p:2,component:"span",sx:(0,_n.V$)(Ee==null?void 0:Ee.bgimg),onClick:function(){var i,p,I=m.script||((i=m.scripts)===null||i===void 0||(p=i[0])===null||p===void 0?void 0:p.script)||"";I&&T.history.push("/code?url=".concat(I))},children:m.name}),m.script&&(0,e.jsx)(N.Z,{sx:{position:"relative"},children:(0,e.jsxs)(ne.Z,{edge:"end","aria-label":m.name,sx:{mr:.5},onClick:function(){m.script&&b.run({url:m.script,isRemote:!0})},children:[(0,e.jsx)(Ie.Z,{color:"primary"}),((E=b.fetches[m.script])===null||E===void 0?void 0:E.loading)&&(0,e.jsx)(w.Z,{size:24,sx:{position:"absolute",top:"50%",left:"50%",marginTop:"-12px",marginLeft:"-12px"}})]})})]}),((t=m.descs_html)===null||t===void 0?void 0:t.length)>0&&(0,e.jsx)(We.Z,{sx:{padding:2,mb:2},elevation:3,children:m.descs_html.map(function(o,i){return(0,e.jsx)(Kn,{color:"grey",display:"block",variant:"caption",sx:{mb:0},dangerouslySetInnerHTML:{__html:o}},"html-".concat(i))})},"html"),((u=m.scripts)===null||u===void 0?void 0:u.length)&&(0,e.jsx)(We.Z,{sx:{padding:2,mb:2},elevation:3,children:(0,e.jsxs)(A.Z,{spacing:2,children:[(0,e.jsxs)(A.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[(0,e.jsx)(B.Z,{variant:"body2",children:"\u5E94\u7528\u811A\u672C"}),(0,e.jsx)(vn,{color:"primary",badgeContent:(d=m.scripts)===null||d===void 0?void 0:d.length,sx:{color:function(i){return i.palette.common.white}}})]}),(0,e.jsx)(ie.Z,{disablePadding:!0,children:m.scripts.map(function(o,i){var p;return(0,e.jsx)(se.ZP,{sx:{padding:0,mb:2},secondaryAction:(0,e.jsxs)(ne.Z,{edge:"end",sx:{mr:-3.5,position:"relative"},"aria-label":o.name,onClick:function(){b.run({url:o.script,isRemote:!0})},children:[(0,e.jsx)(Ie.Z,{}),((p=b.fetches[o.script])===null||p===void 0?void 0:p.loading)&&(0,e.jsx)(w.Z,{size:24,sx:{position:"absolute",top:"50%",left:"50%",marginTop:"-12px",marginLeft:"-12px"}})]}),children:(0,e.jsx)(B.Z,{variant:"body2",sx:{fontWeight:500},component:"span",onClick:function(){T.history.push("/code?url=".concat(o.script))},children:"".concat(i+1,".").concat(o.name)})},o.name)})})]})},"scripts"),((l=m.settings)===null||l===void 0?void 0:l.length)&&(0,e.jsx)(We.Z,{sx:{mb:2},elevation:3,children:(0,e.jsxs)(A.Z,{spacing:2,children:[(0,e.jsxs)(A.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",p:2,children:[(0,e.jsx)(B.Z,{variant:"body2",children:"\u5E94\u7528\u8BBE\u7F6E"}),(0,e.jsx)(vn,{color:"primary",badgeContent:(s=m.settings)===null||s===void 0?void 0:s.length,sx:{color:function(i){return i.palette.common.white}}})]}),(g=C.fetches.chavy_boxjs_cur_sessions)!==null&&g!==void 0&&g.loading?null:(0,e.jsx)(En,{formConfig:m.settings})]})},"setting"),(m==null||(v=m.keys)===null||v===void 0?void 0:v.length)!==0?(0,e.jsxs)(We.Z,{elevation:3,sx:{mb:2},children:[(0,e.jsx)(N.Z,{sx:{borderBottom:1,borderColor:"divider",px:2,py:1},children:(0,e.jsxs)(A.Z,{direction:"row",spacing:2,children:[(0,e.jsx)(B.Z,{children:"\u5F53\u524D\u4F1A\u8BDD"}),U.name?(0,e.jsxs)(B.Z,{color:"primary",children:["#",U.name]}):null]})}),(0,e.jsx)(N.Z,{sx:{p:2},children:(0,e.jsx)(ie.Z,{disablePadding:!0,children:U==null?void 0:U.datas.map(function(o){return(0,e.jsxs)(se.ZP,{sx:{p:0},children:[(0,e.jsx)(ye.Z,{primary:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("span",{style:{maxWidth:"85%",display:"inline-block",textOverflow:"ellipsis",overflow:"hidden",height:"100%",verticalAlign:"middle"},children:o.key}),o.val&&(0,e.jsx)(ne.Z,{onClick:function(){he()(o.val),q.alert({open:!0,message:"\u590D\u5236\u6210\u529F",type:"success"})},children:(0,e.jsx)(Fn.Z,{fontSize:"small"})})]}),primaryTypographyProps:{noWrap:!0,variant:"caption",sx:{fontWeight:"bold"}},secondary:(0,e.jsx)(B.Z,{noWrap:!0,color:"grey",variant:"caption",component:"div",children:(Y()(o.val)==="object"&&o.val?JSON.stringify(o.val):o.val)||"\u65E0\u6570\u636E"})}),(0,e.jsx)(ne.Z,{onClick:function(){var p=X()((U==null?void 0:U.datas)||[]),I=p.findIndex(function(G){return G.key===o.key});p[I].val="",C.run(p)},children:(0,e.jsx)(An.Z,{fontSize:"small"})})]},o.key)})})}),(0,e.jsx)(N.Z,{p:1,sx:{borderTop:1,borderColor:"divider",display:"flex",justifyContent:"flex-end"},children:(0,e.jsx)(W.Z,{color:"error",onClick:function(){if(P){var i=a()({},U);Ze?i.name="\u4F1A\u8BDD 1":i.name="\u4F1A\u8BDD ".concat(P.length+1),i.id=cn()(),h&&C.run([{key:"@chavy_boxjs_sessions.".concat(ee.length),val:a()({},i)}])}},children:"\u514B\u9686"})})]},"curSessionItem"):(0,e.jsx)(e.Fragment,{}),(P==null?void 0:P.length)!==0&&(m==null||(S=m.keys)===null||S===void 0?void 0:S.length)!==0?(0,e.jsxs)(We.Z,{elevation:3,children:[(0,e.jsx)(N.Z,{sx:{borderBottom:1,borderColor:"divider"},children:(0,e.jsx)(Tn.Z,{value:Se,scrollButtons:!0,variant:"scrollable",allowScrollButtonsMobile:!0,"aria-label":"scrollable force tabs example",sx:ge()({},"& .".concat(Rn.Z.scrollButtons),{"&.Mui-disabled":{opacity:.3}}),onChange:function(i,p){return Ke(p)},children:P==null?void 0:P.map(function(o,i){return(0,e.jsx)(Wn.Z,a()({label:(0,e.jsxs)(A.Z,{spacing:1,direction:"row",alignItems:"center",children:[fe===i?(0,e.jsx)(In.Z,{sx:{width:16,height:16}}):null,(0,e.jsxs)(B.Z,{children:[Ze?"":"".concat(i+1," # "),o.name]})]})},Un(i)),o.id)})})}),P==null?void 0:P.map(function(o,i){return(0,e.jsx)(Vn,{value:i,index:Se,children:(0,e.jsx)(ie.Z,{disablePadding:!0,children:o==null?void 0:o.datas.map(function(p){return(0,e.jsx)(se.ZP,{sx:{p:0},children:(0,e.jsx)(ye.Z,{primary:"".concat(p.key),primaryTypographyProps:{variant:"caption",sx:{fontWeight:"bold"}},secondary:(0,e.jsx)(B.Z,{color:"grey",variant:"caption",noWrap:!0,component:"div",children:(Y()(p.val)==="object"?JSON.stringify(p.val):p.val)||"\u65E0\u6570\u636E"})})},p.key)})})},o.id)}),(0,e.jsx)(N.Z,{p:1,sx:{borderTop:1,borderColor:"divider"},children:(0,e.jsxs)(A.Z,{direction:"row",alignItems:"center",justifyContent:"flex-end",children:[!Ze&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(W.Z,{color:"error",onClick:function(){h&&C.run([{key:"@chavy_boxjs_sessions.".concat(Z),val:null}]).then(function(){H(0)})},children:"\u5220\u9664"}),(0,e.jsx)(W.Z,{color:"warning",onClick:function(){ae({update:{open:!0,data:Q,val:pe}})},children:"\u4FEE\u6539"}),(0,e.jsx)(W.Z,{color:"primary",onClick:function(){!h||!F||C.run([{key:"chavy_boxjs_cur_sessions",val:JSON.stringify(a()(a()({},h==null?void 0:h.boxdata.curSessions),{},ge()({},F,Q.id)))}].concat(X()(Q.datas)))},children:"\u5E94\u7528"})]}),(0,e.jsx)(W.Z,{color:"success",onClick:function(){he()(JSON.stringify(pe)),q.alert({open:!0,message:"\u590D\u5236\u6210\u529F",type:"success"})},children:"\u590D\u5236"})]})})]}):(0,e.jsx)(e.Fragment,{})]}):"No find App"}}}]);
