"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[371],{86587:function(z,j,n){n.r(j),n.d(j,{default:function(){return lo}});var G=n(5574),I=n.n(G),$=n(13769),F=n.n($),H=n(97857),y=n.n(H),J=n(58291),p=n(22148),N=n(90948),k=n(90629),Q=n(98396),W=n(51233),A=n(87357),B=n(69661),V=n(81458),X=n(15861),Y=n(7145),q=n.n(Y),R=n(67294),oo=n(98958),U=n(98169),io=n(63679),no=n(36963),eo=n(9628),t=n(85893),to=["item","script","moveCard","findCard","data"],ao=(0,N.ZP)(k.Z)(function(u){var r=u.theme;return y()(y()({},r.typography.body2),{},{textAlign:"center",color:r.palette.text.secondary,overflow:"hidden",background:"unset",boxShadow:"unset",borderRadius:0})}),h={},S={},ro=function(r){var d,o=r.item,M=r.script,E=r.moveCard,C=r.findCard,O=r.data,T=F()(r,to),_=(0,Q.Z)("(min-width:960px)"),v="".concat(o==null?void 0:o.id,"_").concat(o==null?void 0:o.author),P=(0,p.useModel)("@@initialState"),s=P.initialState,D=(0,p.useModel)("api"),i=D.fetchRunScript,l=D.fetchSave,a=C(v).index,m=(0,oo.c)(function(){return{type:"grid",item:{id:v,originalIndex:a},collect:function(e){var f=e.getSourceClientOffset(),x={x:0,y:0};return f&&(x.x=f.x,x.y=f.y),{offset:x,isDragging:e.isDragging()}},end:function(e,f){var x=e.id,K=e.originalIndex,mo=f.didDrop();mo||E(x,K);var xo=O==null?void 0:O.map(function(L){return L==null?void 0:L.id}),po=s==null?void 0:s.boxdata.usercfgs;l.run({key:J.Z.userCfgs,val:JSON.stringify(y()(y()({},po),{},{favapps:xo}))})}}},[v,a,E]),c=I()(m,2),Z=c[0],w=Z.isDragging,b=Z.offset,uo=c[1],vo=(0,U.L)(function(){return{accept:"grid",hover:function(e){var f=e.id;if(f!==v){var x=C(v),K=x.index;E(f,K)}}}},[C,E]),co=I()(vo,2),fo=co[1],ho=w?0:1;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ao,{sx:{flex:_?"0 0 ".concat(100/6,"%"):"0 0 25%",opacity:ho,transform:"translate(0,0)",pt:1,pb:1},ref:function(e){return uo(fo(e))},onClick:function(){var e="".concat(o==null?void 0:o.id);h[e]===void 0&&(h[e]=0),h[e]+=1,S[e]=setTimeout(function(){if(S[e]!==void 0&&clearTimeout(S[e]),h[e]===2){if(h[e]=0,!M)return p.history.push("/app/".concat(e));i.run({url:M,isRemote:!0})}else h[e]===1&&p.history.push("/app/".concat(e));h={}},200)},children:(0,t.jsxs)(W.Z,{spacing:1,justifyContent:"center",alignItems:"center",children:[(0,t.jsxs)(A.Z,{sx:{width:56,height:56,borderRadius:2,overflow:"hidden",position:"relative",boxShadow:function(e){return e.shadows[5]}},children:[(0,t.jsx)(B.Z,{variant:"square",alt:o==null?void 0:o.name,src:o==null?void 0:o.icon,sx:{width:"100%",height:"100%"}}),((d=i.fetches["".concat(M)])===null||d===void 0?void 0:d.loading)&&(0,t.jsx)(V.Z,{sx:{position:"absolute",bottom:0,width:"100%"}})]}),(0,t.jsx)(X.Z,{variant:"body2",sx:{fontSize:12,maxWidth:56,color:s!=null&&s.boxdata.usercfgs.bgimg?"#fff":"unset",width:"100%",fontWeight:"bold",textShadow:s!=null&&s.boxdata.usercfgs.bgimg?"black 0.1em 0.1em 0.2em":"unset"},noWrap:!0,children:o==null?void 0:o.name})]})},"".concat(o==null?void 0:o.id,"/").concat(o==null?void 0:o.author,"/").concat(o==null?void 0:o.name)),w&&(s==null?void 0:s.isMobile)&&(0,t.jsx)(W.Z,{sx:{zIndex:-1,opacity:.5,position:"fixed",left:b==null?void 0:b.x,top:b==null?void 0:b.y},spacing:1,justifyContent:"center",alignItems:"center",children:(0,t.jsx)(A.Z,{sx:{width:40,height:40,borderRadius:2,overflow:"hidden",position:"relative",boxShadow:function(e){return e.shadows[4]}},children:(0,t.jsx)(B.Z,{variant:"square",alt:o==null?void 0:o.name,src:o==null?void 0:o.icon,sx:{width:"100%",height:"100%"}})})})]})},so=(0,R.memo)(ro);function _o(){var u,r=(0,p.useModel)("@@initialState"),d=r.initialState,o=(0,U.L)(function(){return{accept:"grid"}}),M=I()(o,2),E=M[1],C=(d==null||(u=d.boxdata)===null||u===void 0?void 0:u.usercfgs.favapps.map(function(i){return d==null?void 0:d.apps.find(function(l){return l.id===i})}).filter(function(i){return!!i}))||[],O=(0,R.useState)(C),T=I()(O,2),_=T[0],v=T[1],P=(0,R.useCallback)(function(i){var l=_.filter(function(a){return"".concat(a==null?void 0:a.id,"_").concat(a==null?void 0:a.author)===i})[0];return{card:l,index:_.indexOf(l)}},[_]),s=(0,R.useCallback)(function(i,l){var a=P(i),m=a.card,c=a.index;v(q()(_,{$splice:[[c,1],[l,0,m]]}))},[P,_,v]),D=d==null?void 0:d.ui(d.boxdata);return(0,t.jsx)(W.Z,{ref:E,direction:"row",flexWrap:"wrap",children:_==null?void 0:_.map(function(i,l){var a;D==null||D.loadAppBaseInfo(i);var m=null;if(i!=null&&i.script)m=i==null?void 0:i.script;else if(i!=null&&i.scripts&&i!==null&&i!==void 0&&(a=i.scripts[0])!==null&&a!==void 0&&a.script){var c;m=i==null||(c=i.scripts[0])===null||c===void 0?void 0:c.script}return(0,t.jsx)(so,{item:i,data:_,script:m,findCard:P,moveCard:s,index:l},"".concat(i==null?void 0:i.id,"-").concat(i==null?void 0:i.author))})})}function lo(){var u=(0,p.useModel)("@@initialState"),r=u.initialState;return(0,t.jsx)(A.Z,{pt:1,component:"div",children:(0,t.jsx)(io.W,{options:{delay:400},backend:r!=null&&r.isMobile?eo.zr:no.PD,children:(0,t.jsx)(_o,{})})})}},58291:function(z,j){j.Z={logo:"https://raw.githubusercontent.com/Orz-3/mini/master/Color/box.png",userCfgs:"chavy_boxjs_userCfgs",sessions:"chavy_boxjs_sessions",app_subCaches:"chavy_boxjs_app_subCaches",backups:"chavy_boxjs_backups",cursessions:"chavy_boxjs_cur_sessions",gistCacheKey:"@chavy_boxjs_userCfgs.gist_cache_key",viewkeys:"@chavy_boxjs_userCfgs.viewkeys"}}}]);
