"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[371],{86587:function($,M,n){n.r(M),n.d(M,{default:function(){return _o}});var w=n(5574),C=n.n(w),G=n(13769),k=n.n(G),F=n(97857),P=n.n(F),H=n(58291),h=n(22148),J=n(90948),N=n(90629),L=n(86886),B=n(51233),A=n(87357),U=n(69661),Q=n(81458),V=n(15861),X=n(7145),Y=n.n(X),O=n(67294),q=n(98958),Z=n(98169),oo=n(63679),io=n(36963),no=n(9628),t=n(85893),eo=["item","script","moveCard","findCard","data"],to=(0,J.ZP)(N.Z)(function(u){var r=u.theme;return P()(P()({},r.typography.body2),{},{textAlign:"center",color:r.palette.text.secondary,overflow:"hidden",background:"unset",boxShadow:"unset",borderRadius:0})}),c={},W={},ao=function(r){var _,o=r.item,D=r.script,m=r.moveCard,g=r.findCard,b=r.data,S=k()(r,eo),d="".concat(o==null?void 0:o.id,"_").concat(o==null?void 0:o.author),j=(0,h.useModel)("@@initialState"),a=j.initialState,I=(0,h.useModel)("api"),E=I.fetchRunScript,i=I.fetchSave,l=g(d).index,s=(0,q.c)(function(){return{type:"grid",item:{id:d,originalIndex:l},collect:function(e){var v=e.getSourceClientOffset(),f={x:0,y:0};return v&&(f.x=v.x,f.y=v.y),{offset:f,isDragging:e.isDragging()}},end:function(e,v){var f=e.id,T=e.originalIndex,ho=v.didDrop();ho||m(f,T);var mo=b==null?void 0:b.map(function(K){return K==null?void 0:K.id}),Eo=a==null?void 0:a.boxdata.usercfgs;i.run({key:H.Z.userCfgs,val:JSON.stringify(P()(P()({},Eo),{},{favapps:mo}))})}}},[d,l,m]),y=C()(s,2),R=y[0],z=R.isDragging,x=R.offset,lo=y[1],uo=(0,Z.L)(function(){return{accept:"grid",hover:function(e){var v=e.id;if(v!==d){var f=g(d),T=f.index;m(v,T)}}}},[g,m]),vo=C()(uo,2),co=vo[1],fo=z?0:1;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(L.ZP,{item:!0,xs:3,md:2,style:{opacity:fo,transform:"translate(0,0)"},children:(0,t.jsx)(to,{ref:function(e){return lo(co(e))},onClick:function(){var e="".concat(o==null?void 0:o.id);c[e]===void 0&&(c[e]=0),c[e]+=1,W[e]=setTimeout(function(){if(W[e]!==void 0&&clearTimeout(W[e]),c[e]===2){if(c[e]=0,!D)return h.history.push("/app/".concat(e));E.run({url:D,isRemote:!0})}else c[e]===1&&h.history.push("/app/".concat(e));c={}},200)},children:(0,t.jsxs)(B.Z,{spacing:1,justifyContent:"center",alignItems:"center",children:[(0,t.jsxs)(A.Z,{sx:{width:50,height:50,borderRadius:2,overflow:"hidden",position:"relative",boxShadow:function(e){return e.shadows[4]}},children:[(0,t.jsx)(U.Z,{variant:"square",alt:o==null?void 0:o.name,src:o==null?void 0:o.icon,sx:{width:"100%",height:"100%",background:"#ECECEE"}}),((_=E.fetches["".concat(D)])===null||_===void 0?void 0:_.loading)&&(0,t.jsx)(Q.Z,{sx:{position:"absolute",bottom:0,width:"100%"}})]}),(0,t.jsx)(V.Z,{variant:"body2",sx:{fontSize:10,color:a!=null&&a.boxdata.usercfgs.bgimg?"#fff":"unset",width:"100%",fontWeight:"bold",textShadow:a!=null&&a.boxdata.usercfgs.bgimg?"black 0.1em 0.1em 0.2em":"unset"},noWrap:!0,children:o==null?void 0:o.name})]})})},"".concat(o==null?void 0:o.id,"/").concat(o==null?void 0:o.author,"/").concat(o==null?void 0:o.name)),z&&(a==null?void 0:a.isMobile)&&(0,t.jsx)(B.Z,{sx:{zIndex:-1,opacity:.5,position:"fixed",left:x==null?void 0:x.x,top:x==null?void 0:x.y},spacing:1,justifyContent:"center",alignItems:"center",children:(0,t.jsx)(A.Z,{sx:{width:40,height:40,borderRadius:2,overflow:"hidden",position:"relative",boxShadow:function(e){return e.shadows[4]}},children:(0,t.jsx)(U.Z,{variant:"square",alt:o==null?void 0:o.name,src:o==null?void 0:o.icon,sx:{width:"100%",height:"100%"}})})})]})},ro=(0,O.memo)(ao);function so(){var u,r=(0,h.useModel)("@@initialState"),_=r.initialState,o=(0,Z.L)(function(){return{accept:"grid"}}),D=C()(o,2),m=D[1],g=(_==null||(u=_.boxdata)===null||u===void 0?void 0:u.usercfgs.favapps.map(function(i){return _==null?void 0:_.apps.find(function(l){return l.id===i})}).filter(function(i){return!!i}))||[],b=(0,O.useState)(g),S=C()(b,2),d=S[0],j=S[1],a=(0,O.useCallback)(function(i){var l=d.filter(function(s){return"".concat(s==null?void 0:s.id,"_").concat(s==null?void 0:s.author)===i})[0];return{card:l,index:d.indexOf(l)}},[d]),I=(0,O.useCallback)(function(i,l){var s=a(i),y=s.card,R=s.index;j(Y()(d,{$splice:[[R,1],[l,0,y]]}))},[a,d,j]),E=_==null?void 0:_.ui(_.boxdata);return(0,t.jsx)(L.ZP,{ref:m,container:!0,spacing:4,children:d==null?void 0:d.map(function(i,l){E==null||E.loadAppBaseInfo(i);var s=null;return i!=null&&i.script?s=i==null?void 0:i.script:i!=null&&i.scripts&&i!==null&&i!==void 0&&i.scripts[0].script&&(s=i==null?void 0:i.scripts[0].script),(0,t.jsx)(ro,{item:i,data:d,script:s,findCard:a,moveCard:I,index:l},"".concat(i==null?void 0:i.id,"-").concat(i==null?void 0:i.author))})})}function _o(){var u=(0,h.useModel)("@@initialState"),r=u.initialState;return(0,t.jsx)(A.Z,{pt:4,component:"div",children:(0,t.jsx)(oo.W,{backend:r!=null&&r.isMobile?no.zr:io.PD,options:{delay:400},children:(0,t.jsx)(so,{})})})}},58291:function($,M){M.Z={logo:"https://raw.githubusercontent.com/Orz-3/mini/master/Color/box.png",userCfgs:"chavy_boxjs_userCfgs",sessions:"chavy_boxjs_sessions",app_subCaches:"chavy_boxjs_app_subCaches",backups:"chavy_boxjs_backups",cursessions:"chavy_boxjs_cur_sessions",gistCacheKey:"@chavy_boxjs_userCfgs.gist_cache_key",viewkeys:"@chavy_boxjs_userCfgs.viewkeys"}}}]);
