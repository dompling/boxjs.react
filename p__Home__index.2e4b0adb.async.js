"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[371],{86587:function($,M,n){n.r(M),n.d(M,{default:function(){return _o}});var G=n(5574),P=n.n(G),w=n(13769),F=n.n(w),H=n(97857),C=n.n(H),J=n(58291),h=n(22148),N=n(90948),Q=n(90629),B=n(86886),K=n(51233),A=n(87357),U=n(69661),V=n(81458),X=n(15861),Y=n(7145),k=n.n(Y),O=n(67294),q=n(98958),Z=n(98169),oo=n(63679),io=n(36963),no=n(9628),e=n(85893),to=["item","script","moveCard","findCard","data"],eo=(0,N.ZP)(Q.Z)(function(u){var r=u.theme;return C()(C()({},r.typography.body2),{},{textAlign:"center",color:r.palette.text.secondary,overflow:"hidden",background:"unset",boxShadow:"unset",borderRadius:0})}),c={},W={},ao=function(r){var _,o=r.item,D=r.script,m=r.moveCard,b=r.findCard,g=r.data,S=F()(r,to),d="".concat(o==null?void 0:o.id,"_").concat(o==null?void 0:o.author),j=(0,h.useModel)("@@initialState"),a=j.initialState,I=(0,h.useModel)("api"),E=I.fetchRunScript,i=I.fetchSave,l=b(d).index,s=(0,q.c)(function(){return{type:"grid",item:{id:d,originalIndex:l},collect:function(t){var v=t.getSourceClientOffset(),f={x:0,y:0};return v&&(f.x=v.x,f.y=v.y),{offset:f,isDragging:t.isDragging()}},end:function(t,v){var f=t.id,T=t.originalIndex,ho=v.didDrop();ho||m(f,T);var mo=g==null?void 0:g.map(function(L){return L==null?void 0:L.id}),Eo=a==null?void 0:a.boxdata.usercfgs;i.run({key:J.Z.userCfgs,val:JSON.stringify(C()(C()({},Eo),{},{favapps:mo}))})}}},[d,l,m]),R=P()(s,2),y=R[0],z=y.isDragging,p=y.offset,lo=R[1],uo=(0,Z.L)(function(){return{accept:"grid",hover:function(t){var v=t.id;if(v!==d){var f=b(d),T=f.index;m(v,T)}}}},[b,m]),vo=P()(uo,2),co=vo[1],fo=z?0:1;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(B.ZP,{item:!0,xs:3,md:2,style:{opacity:fo,transform:"translate(0,0)"},children:(0,e.jsx)(eo,{ref:function(t){return lo(co(t))},onClick:function(){var t="".concat(o==null?void 0:o.id);c[t]===void 0&&(c[t]=0),c[t]+=1,W[t]=setTimeout(function(){if(W[t]!==void 0&&clearTimeout(W[t]),c[t]===2){if(c[t]=0,!D)return h.history.push("/app/".concat(t));E.run({url:D,isRemote:!0})}else c[t]===1&&h.history.push("/app/".concat(t));c={}},200)},children:(0,e.jsxs)(K.Z,{spacing:1,justifyContent:"center",alignItems:"center",children:[(0,e.jsxs)(A.Z,{sx:{width:50,height:50,borderRadius:2,overflow:"hidden",position:"relative",boxShadow:function(t){return t.shadows[4]}},children:[(0,e.jsx)(U.Z,{variant:"square",alt:o==null?void 0:o.name,src:o==null?void 0:o.icon,sx:{width:"100%",height:"100%",background:"#ECECEE"}}),((_=E.fetches["".concat(D)])===null||_===void 0?void 0:_.loading)&&(0,e.jsx)(V.Z,{sx:{position:"absolute",bottom:0,width:"100%"}})]}),(0,e.jsx)(X.Z,{variant:"body2",sx:{fontSize:10,color:a!=null&&a.boxdata.usercfgs.bgimg?"#fff":"unset",width:"100%",fontWeight:"bold",textShadow:a!=null&&a.boxdata.usercfgs.bgimg?"black 0.1em 0.1em 0.2em":"unset"},noWrap:!0,children:o==null?void 0:o.name})]})})},"".concat(o==null?void 0:o.id,"/").concat(o==null?void 0:o.author,"/").concat(o==null?void 0:o.name)),z&&(a==null?void 0:a.isMobile)&&(0,e.jsx)(K.Z,{sx:{zIndex:-1,opacity:.5,position:"fixed",left:p==null?void 0:p.x,top:p==null?void 0:p.y},spacing:1,justifyContent:"center",alignItems:"center",children:(0,e.jsx)(A.Z,{sx:{width:40,height:40,borderRadius:2,overflow:"hidden",position:"relative",boxShadow:function(t){return t.shadows[4]}},children:(0,e.jsx)(U.Z,{variant:"square",alt:o==null?void 0:o.name,src:o==null?void 0:o.icon,sx:{width:"100%",height:"100%"}})})})]})},ro=(0,O.memo)(ao);function so(){var u,r=(0,h.useModel)("@@initialState"),_=r.initialState,o=(0,Z.L)(function(){return{accept:"grid"}}),D=P()(o,2),m=D[1],b=(_==null||(u=_.boxdata)===null||u===void 0?void 0:u.usercfgs.favapps.map(function(i){return _==null?void 0:_.apps.find(function(l){return l.id===i})}).filter(function(i){return!!i}))||[],g=(0,O.useState)(b),S=P()(g,2),d=S[0],j=S[1],a=(0,O.useCallback)(function(i){var l=d.filter(function(s){return"".concat(s==null?void 0:s.id,"_").concat(s==null?void 0:s.author)===i})[0];return{card:l,index:d.indexOf(l)}},[d]),I=(0,O.useCallback)(function(i,l){var s=a(i),R=s.card,y=s.index;j(k()(d,{$splice:[[y,1],[l,0,R]]}))},[a,d,j]),E=_==null?void 0:_.ui(_.boxdata);return(0,e.jsx)(B.ZP,{ref:m,container:!0,spacing:4,children:d==null?void 0:d.map(function(i,l){E==null||E.loadAppBaseInfo(i);var s=null;return i!=null&&i.script?s=i==null?void 0:i.script:i!=null&&i.scripts&&i!==null&&i!==void 0&&i.scripts[0].script&&(s=i==null?void 0:i.scripts[0].script),(0,e.jsx)(ro,{item:i,data:d,script:s,findCard:a,moveCard:I,index:l},"".concat(i==null?void 0:i.id,"-").concat(i==null?void 0:i.author))})})}function _o(){var u=(0,h.useModel)("@@initialState"),r=u.initialState;return(0,e.jsx)(A.Z,{pt:4,component:"div",children:(0,e.jsx)(oo.W,{backend:r!=null&&r.isMobile?no.zr:io.PD,options:{delay:400},children:(0,e.jsx)(so,{})})})}},58291:function($,M){M.Z={logo:"https://raw.githubusercontent.com/Orz-3/mini/master/Color/box.png",userCfgs:"chavy_boxjs_userCfgs",sessions:"chavy_boxjs_sessions",app_subCaches:"chavy_boxjs_app_subCaches",backups:"chavy_boxjs_backups",cursessions:"chavy_boxjs_cur_sessions"}}}]);
