"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[35],{32646:function(sn,ge,n){n.d(ge,{k:function(){return $}});var De=n(97857),ye=n.n(De),Me=n(90948),Y=n(45843),_e=n(85893),$=(0,Me.ZP)(function(ce){return(0,_e.jsx)(Y.Z,ye()({focusVisibleClassName:".Mui-focusVisible",disableRipple:!0},ce))})(function(ce){var M=ce.theme;return{width:42,height:26,padding:0,"& .MuiSwitch-switchBase":{padding:0,margin:2,transitionDuration:"300ms","&.Mui-checked":{transform:"translateX(16px)",color:"#fff","& + .MuiSwitch-track":{backgroundColor:M.palette.primary,opacity:1,border:0},"&.Mui-disabled + .MuiSwitch-track":{opacity:.5}},"&.Mui-focusVisible .MuiSwitch-thumb":{color:M.palette.primary,border:"6px solid #fff"},"&.Mui-disabled .MuiSwitch-thumb":{color:M.palette.mode==="light"?M.palette.grey[100]:M.palette.grey[600]},"&.Mui-disabled + .MuiSwitch-track":{opacity:M.palette.mode==="light"?.7:.3}},"& .MuiSwitch-thumb":{boxSizing:"border-box",width:22,height:22},"& .MuiSwitch-track":{borderRadius:26/2,backgroundColor:M.palette.mode==="light"?"#E9E9EA":"#39393D",opacity:1,transition:M.transitions.create(["background-color"],{duration:500})}}})},16961:function(sn,ge,n){var De=n(52677),ye=n.n(De),Me=n(97857),Y=n.n(Me),_e=n(19632),$=n.n(_e),ce=n(5574),M=n.n(ce),Ue=n(13769),a=n.n(Ue),Oe=n(33525),ve=n(22148),Ne=n(40625),$e=n(42761),ze=n(90089),Fe=n(93946),He=n(42293),Je=n(10155),Ae=n(78462),ne=n(97212),ke=n(59334),Qe=n(15861),ie=n(83321),se=n(50657),Ce=n(31425),I=n(50480),W=n(75438),Ge=n(36872),Xe=n(72890),be=n(93109),oe=n(67294),y=n(85893),Ye=["defaultValue"],_=(0,oe.forwardRef)(function(e,we){var qe=e.defaultValue,re=a()(e,Ye),en=oe.useState(!1),k=M()(en,2),nn=k[0],Ze=k[1],Ie=(0,oe.useState)(qe),Ke=M()(Ie,2),he=Ke[0],z=Ke[1],te=(0,oe.useState)(""),me=M()(te,2),B=me[0],Be=me[1],Te=(0,be.Z)(B,{wait:100}),on=(0,ve.useModel)("@@initialState"),K=on.initialState,w=[{id:"extra_data_key",name:"\u975E\u8BA2\u9605\u6570\u636E",_id:"extra_data_key@local",keys:(K==null?void 0:K.boxdata.usercfgs.gist_cache_key)||[],descs_html:[],author:"local",repo:"",icons:[]}].concat($()(((K==null?void 0:K.boxdata.sysapps)||[]).filter(function(x){return x.keys&&!!x.keys.length})));Object.values((K==null?void 0:K.boxdata.appSubCaches)||{}).forEach(function(x){w=[].concat($()(w),$()(x.apps.filter(function(A){return A.keys&&!!A.keys.length})))}),w=w.filter(function(x){return x.name.indexOf(Te)>-1||!Te?!0:!!x.keys.find(function(A){return A.indexOf(Te)>-1})});var V=K==null?void 0:K.boxdata.datas;(0,oe.useImperativeHandle)(we,function(){return{value:he}}),(0,oe.useEffect)(function(){z(re.value)},[re.value]);var H=function(){Ze(!1),Be("")},xe=function(A){var G;z(A),(G=re.onChange)===null||G===void 0||G.call(re,{target:{name:re.name,value:A}})};return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(ze.Z,Y()(Y()({},re),{},{value:he,onChange:function(A){xe(A.target.value)},size:"small",type:"text",endAdornment:(0,y.jsx)(Fe.Z,{size:"small","aria-label":re.name,onClick:function(){Ze(!0)},children:(0,y.jsx)(Ne.Z,{fontSize:"small",sx:{color:function(A){return A.palette.primary.main}}})})})),(0,y.jsxs)(se.Z,{open:nn,onClose:function(){return H()},sx:{mt:15,mb:15,"& .MuiDialog-paper":{width:"100%"}},children:[(0,y.jsx)(He.Z,{position:"static",sx:{background:function(A){return A.palette.primary.main}},children:(0,y.jsx)(Je.Z,{children:(0,y.jsxs)(Oe.ol,{children:[(0,y.jsx)(Oe.el,{placeholder:"\u8BF7\u8F93\u5165\u5E94\u7528\u540D\u79F0\u6216\u7F13\u5B58Key",inputProps:{"aria-label":"search"},onChange:function(A){Be(A.target.value)}}),(0,y.jsx)(Oe.cB,{children:(0,y.jsx)($e.Z,{})})]})})}),(0,y.jsx)(Ae.Z,{subheader:(0,y.jsx)("li",{}),sx:{position:"relative",overflow:"auto",minHeight:300,"& ul":{padding:0}},children:(0,y.jsx)(Xe.Z,{name:"radio-buttons-group",onChange:function(A,G){xe(G)},children:w.length>0?w.map(function(x,A){var G,fe,Re="".concat(x.id,"_").concat(x.author,"_").concat(A);return(0,y.jsxs)("li",{style:{width:"100%",boxSizing:"border-box"},children:[(0,y.jsxs)(W.Z,{sx:{borderBottom:"1px solid rgba(0, 0, 0, .125)",mt:0},children:[x==null?void 0:x.name,"\uFF08",x==null||(G=x.keys)===null||G===void 0?void 0:G.length,"\uFF09"]}),x==null||(fe=x.keys)===null||fe===void 0?void 0:fe.map(function(le){return(0,y.jsx)(ne.ZP,{sx:{p:0,pl:3,pr:3},children:(0,y.jsx)(ke.Z,{id:Re,primary:(0,y.jsx)(I.Z,{value:le,control:(0,y.jsx)(Ge.Z,{}),label:le,sx:{"& .MuiFormControlLabel-label":{width:"80%",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"noWrap"}}}),primaryTypographyProps:{noWrap:!0,variant:"caption",sx:{fontWeight:"bold"}},secondary:(0,y.jsx)(Qe.Z,{noWrap:!0,color:"grey",variant:"caption",component:"div",children:(ye()(V==null?void 0:V[le])==="object"&&(V!=null&&V[le])?JSON.stringify(V==null?void 0:V[le]):V==null?void 0:V[le])||"\u65E0\u6570\u636E"})})},"".concat(Re,"-").concat(le))})]},"section-".concat(Re))}):(0,y.jsx)(ne.ZP,{sx:{height:290,textAlign:"center"},children:(0,y.jsx)(ke.Z,{primary:"\u672A\u627E\u5230\u76F8\u5173\u7ED3\u679C"})})})}),(0,y.jsxs)(Ce.Z,{sx:{borderTop:"1px solid rgba(0, 0, 0, .125)"},children:[(0,y.jsx)(ie.Z,{color:"inherit",onClick:function(){return H()},children:"\u53D6\u6D88"}),(0,y.jsx)(ie.Z,{onClick:function(){return H()},autoFocus:!0,children:"\u786E\u5B9A"})]})]})]})});ge.Z=_},71244:function(sn,ge,n){n.r(ge),n.d(ge,{default:function(){return Un}});var De=n(9783),ye=n.n(De),Me=n(19632),Y=n.n(Me),_e=n(52677),$=n.n(_e),ce=n(5574),M=n.n(ce),Ue=n(97857),a=n.n(Ue),Oe=n(13769),ve=n.n(Oe),Ne=n(49677),$e=n.n(Ne),ze=n(32646),Fe=n(33525),He=n(40625),Je=n(42761),Ae=n(90089),ne=n(93946),ke=n(42293),Qe=n(10155),ie=n(78462),se=n(97212),Ce=n(59334),I=n(15861),W=n(83321),Ge=n(50657),Xe=n(31425),be=n(50480),oe=n(36872),y=n(72890),Ye=n(93109),_=n(67294),e=n(85893),we=["defaultValue","items"],qe=(0,_.forwardRef)(function(v,o){var j=v.defaultValue,E=v.items,t=ve()(v,we),u=_.useState(!1),s=M()(u,2),l=s[0],i=s[1],C=(0,_.useState)(j),p=M()(C,2),P=p[0],f=p[1],h=(0,_.useState)(""),O=M()(h,2),F=O[0],X=O[1],T=(0,Ye.Z)(F,{wait:100}),R=Y()(E||[]);R=R.filter(function(g){return T?typeof g=="string"?g.indexOf(T)>-1||!T:g.key.indexOf(T)>-1||g.label.indexOf(T)>-1:!0}),(0,_.useImperativeHandle)(o,function(){return{value:P}}),(0,_.useEffect)(function(){f(t.value)},[t.value]);var de=function(){i(!1),X("")},ue=function(S){var q;f(S),(q=t.onChange)===null||q===void 0||q.call(t,{target:{name:t.name,value:S}})};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Ae.Z,a()(a()({},t),{},{value:P,onChange:function(S){ue(S.target.value)},size:"small",type:"text",endAdornment:(0,e.jsx)(ne.Z,{size:"small","aria-label":t.name,onClick:function(){i(!0)},children:(0,e.jsx)(He.Z,{fontSize:"small",sx:{color:function(S){return S.palette.primary.main}}})})})),(0,e.jsxs)(Ge.Z,{open:l,onClose:function(){return de()},sx:{mt:15,mb:15,"& .MuiDialog-paper":{width:"100%"}},children:[(0,e.jsx)(ke.Z,{position:"static",sx:{background:function(S){return S.palette.primary.main}},children:(0,e.jsx)(Qe.Z,{children:(0,e.jsxs)(Fe.ol,{children:[(0,e.jsx)(Fe.el,{placeholder:"\u8BF7\u8F93\u5165",inputProps:{"aria-label":"search"},onChange:function(S){X(S.target.value)}}),(0,e.jsx)(Fe.cB,{children:(0,e.jsx)(Je.Z,{})})]})})}),(0,e.jsx)(ie.Z,{subheader:(0,e.jsx)("li",{}),sx:{position:"relative",overflow:"auto",minHeight:300,"& ul":{padding:0}},children:(0,e.jsx)(y.Z,{name:"radio-buttons-group",onChange:function(S,q){ue(q)},children:R.length>0?R.map(function(g){var S={label:"",key:""};return typeof g=="string"?(S.label=g,S.key=g):S=a()({},g),(0,e.jsx)(se.ZP,{sx:{p:0,pl:3,pr:3},children:(0,e.jsx)(Ce.Z,{id:S.key,primary:(0,e.jsx)(be.Z,{value:S.key,control:(0,e.jsx)(oe.Z,{}),label:S.label,sx:{"& .MuiFormControlLabel-label":{width:"80%",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"noWrap"}}}),primaryTypographyProps:{noWrap:!0,variant:"caption",sx:{fontWeight:"bold"}},secondary:typeof g!="string"&&(0,e.jsx)(I.Z,{noWrap:!0,color:"grey",variant:"caption",component:"div",children:S.key})})},S.key)}):(0,e.jsx)(se.ZP,{sx:{height:290,textAlign:"center"},children:(0,e.jsx)(Ce.Z,{primary:"\u672A\u627E\u5230\u76F8\u5173\u7ED3\u679C"})})})}),(0,e.jsxs)(Xe.Z,{sx:{borderTop:"1px solid rgba(0, 0, 0, .125)"},children:[(0,e.jsx)(W.Z,{color:"inherit",onClick:function(){return de()},children:"\u53D6\u6D88"}),(0,e.jsx)(W.Z,{onClick:function(){return de()},autoFocus:!0,children:"\u786E\u5B9A"})]})]})]})}),re=qe,en=n(16961),k=n(22148),nn=n(60181),Ze=n(23508),Ie=n(3018),Ke=n(74423),he=n(56815),z=n(94054),te=n(47312),me=n(50135),B=n(51233),Be=n(40476),Te=n(69368),on=n(10315),K=n(18972),w=n(98456),V=n(58826),H=n(87357),xe=n(82280),x=n(38895),A=n(22797),G=n(20640),fe=n.n(G),Re=n(96486),le=n.n(Re),vn=n(97458),hn=n(30780),U=n(87536),mn={add:"add___mHDQy",picker:"picker___ZxyLG"},xn=["text"],fn=["id"];function pe(v){var o=v.text,j=ve()(v,xn),E=(0,Ke.Z)()||{},t=E.focused,u=_.useMemo(function(){return t?o:""},[t]);return(0,e.jsx)(vn.Z,{type:["top","bottom"],leaveReverse:!0,style:{minHeight:25},children:t?(0,e.jsx)(he.Z,a()(a()({},j),{},{children:u}),o):null})}function rn(v){var o={label:"",key:""};return typeof v=="string"?(o.label=v,o.key=v):o=v,o}var pn=(0,_.forwardRef)(function(v,o){var j=v.value,E=v.defaultValue,t=v.name,u=v.onChange,s=(0,_.useState)(E),l=M()(s,2),i=l[0],C=l[1],p={};return p.color=i,(0,_.useImperativeHandle)(o,function(){return{value:j}}),(0,_.useEffect)(function(){C(j)},[j]),(0,e.jsx)(hn.AI,a()(a()({},p),{},{className:mn.picker,onChangeComplete:function(f){C(f.hex),u==null||u({target:{name:t,value:f.hex}})}}))}),tn=function(o,j){o.name=(o.disabled?"\u{1F232} \u624B\u52A8\u586B\u5199-":"")+o.name;var E=o.id.replaceAll(".","~"),t={name:o.formName||E,control:j==null?void 0:j.control,rules:{pattern:o.pattern}};return(0,e.jsxs)(e.Fragment,{children:[(["text","number"].includes(o.type)||!o.type)&&(0,e.jsxs)(z.Z,{size:"small",sx:{width:1},variant:"standard",children:[(0,e.jsx)(te.Z,{htmlFor:o.id,children:o.name}),(0,e.jsx)(U.Qr,a()(a()({},t),{},{render:function(s){var l=s.field,i=s.formState;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Ae.Z,a()({id:o.id,size:"small",type:o.type,disabled:o.disabled,placeholder:o.placeholder},l)),(0,e.jsx)(pe,{text:o.desc,error:!!i.errors[l.name]})]})}}))]}),o.type==="textarea"&&!o.child&&(0,e.jsx)(U.Qr,a()(a()({},t),{},{render:function(s){var l=s.field,i=s.formState;return(0,e.jsx)(me.Z,a()({fullWidth:!0,multiline:!0,id:o.id,size:"small",label:o.name,variant:"standard",rows:6,helperText:o.desc,disabled:o.disabled,placeholder:o.placeholder,error:!!i.errors[l.name]},l))}})),o.child&&(0,e.jsxs)(z.Z,{size:"small",sx:{width:1},variant:"standard",children:[(0,e.jsx)(te.Z,{htmlFor:o.id,sx:{position:"unset",transform:"unset",mb:2},children:o.name}),(0,e.jsx)(jn,{name:t.name,form:j,setting:o}),(0,e.jsx)(pe,{text:o.desc})]}),o.type==="boolean"&&(0,e.jsxs)(B.Z,{children:[(0,e.jsx)(U.Qr,a()(a()({},t),{},{render:function(s){var l=s.field;return(0,e.jsx)(be.Z,{label:o.name,control:(0,e.jsx)(ze.k,{sx:{m:1},disabled:o.disabled,checked:l.value==="true"||l.value===!0,onChange:function(C){return l.onChange(C.target.checked)}})})}})),(0,e.jsx)(he.Z,{sx:{minHeight:20},children:o.desc})]}),o.type==="checkboxes"&&(0,e.jsxs)(z.Z,{component:"fieldset",variant:"standard",children:[(0,e.jsx)(Be.Z,{component:"legend",children:o.name}),(0,e.jsx)(U.Qr,a()(a()({},t),{},{render:function(s){var l,i=s.field,C=typeof i.value=="string",p=(C&&i.value?i.value.split(","):i.value)||[];return(0,e.jsx)(e.Fragment,{children:(l=o.items)===null||l===void 0?void 0:l.map(function(P){var f=rn(P);return(0,e.jsx)(be.Z,{control:(0,e.jsx)(Te.Z,{checked:p==null?void 0:p.includes(f.key),onChange:function(O){var F=p;O.target.checked?F.push(f.key):F=F.filter(function(X){return X!=f.key}),i.onChange(C?F.join(","):F)}}),label:f.label,disabled:o.disabled},f.key)})})}})),(0,e.jsx)(he.Z,{sx:{minHeight:20},children:o.desc})]}),["modalSelects","cacheKey","text","textarea","selects","boolean","radios","checkboxes","colorpicker","number"].indexOf(o.type)===-1&&(0,e.jsxs)(z.Z,{size:"small",sx:{width:1},variant:"standard",children:[(0,e.jsx)(te.Z,{htmlFor:o.id,children:o.name}),(0,e.jsx)(U.Qr,a()(a()({},t),{},{render:function(s){var l=s.field,i=s.formState;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Ae.Z,a()({id:o.id,size:"small",type:o.type,disabled:o.disabled,placeholder:o.placeholder},l)),(0,e.jsx)(pe,{text:o.desc,error:!!i.errors[l.name]})]})}}))]}),o.type==="radios"&&(0,e.jsxs)(z.Z,{component:"fieldset",variant:"standard",children:[(0,e.jsx)(Be.Z,{component:"legend",children:o.name}),(0,e.jsx)(U.Qr,a()(a()({},t),{},{render:function(s){var l,i=s.field;return(0,e.jsx)(y.Z,a()(a()({},i),{},{children:(l=o.items)===null||l===void 0?void 0:l.map(function(C){var p=rn(C);return(0,e.jsx)(be.Z,{value:p.key,label:p.label,control:(0,e.jsx)(oe.Z,{}),disabled:o.disabled},p.key)})}))}})),(0,e.jsx)(he.Z,{sx:{minHeight:20},children:o.desc})]}),o.type==="selects"&&(0,e.jsxs)(z.Z,{sx:{m:1},variant:"standard",children:[(0,e.jsx)(te.Z,{htmlFor:o.id,children:o.name}),(0,e.jsx)(U.Qr,a()(a()({},t),{},{render:function(s){var l,i=s.field;return(0,e.jsx)(on.Z,a()(a()({placeholder:"\u8BF7\u9009\u62E9",sx:{width:"100%"},MenuProps:{sx:{maxHeight:300}}},i),{},{children:(l=o.items)===null||l===void 0?void 0:l.map(function(C,p){var P=rn(C);return(0,e.jsx)(K.Z,{value:P.key,children:P.label},"".concat(P.key,"_").concat(p))})}))}})),(0,e.jsx)(pe,{text:o.desc})]}),o.type==="modalSelects"&&(0,e.jsx)(z.Z,{sx:{m:1},variant:"standard",children:(0,e.jsx)(U.Qr,a()(a()({},t),{},{render:function(s){var l=s.field,i=s.formState;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(te.Z,{htmlFor:o.id,shrink:!!l.value,children:o.name}),(0,e.jsx)(re,a()(a()({inputProps:{shrink:"true"}},l),{},{items:o.items})),(0,e.jsx)(pe,{text:o.desc,error:!!i.errors[l.name]})]})}}))}),o.type==="cacheKey"&&(0,e.jsx)(z.Z,{size:"small",sx:{width:1},variant:"standard",children:(0,e.jsx)(U.Qr,a()(a()({},t),{},{render:function(s){var l=s.field,i=s.formState;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(te.Z,{htmlFor:o.id,shrink:!!l.value,children:o.name}),(0,e.jsx)(en.Z,a()({},l)),(0,e.jsx)(pe,{text:o.desc,error:!!i.errors[l.name]})]})}}))}),o.type==="colorpicker"&&(0,e.jsxs)(z.Z,{size:"small",sx:{width:1},variant:"standard",children:[(0,e.jsx)(te.Z,{htmlFor:o.id,sx:{position:"unset",transform:"unset",mb:2},children:o.name}),(0,e.jsx)(U.Qr,a()(a()({},t),{},{render:function(s){var l=s.field;return(0,e.jsx)(pn,{value:l.value,onChange:function(C){return l.onChange(C.target.value)}})}})),(0,e.jsx)(pe,{text:o.desc})]})]})},jn=function(o){var j,E,t=o.setting,u=o.form,s=o.name,l=(0,U.Dq)({name:s,control:u==null?void 0:u.control}),i=l.fields,C=l.append,p=l.remove,P=(0,k.useModel)("api"),f=P.fetchRunScript,h=(0,U.cI)(),O=(0,k.useModel)("alert"),F=(0,_.useState)(""),X=M()(F,2),T=X[0],R=X[1],de=(0,_.useState)(!1),ue=M()(de,2),g=ue[0],S=ue[1],q=(0,_.useState)(!1),Se=M()(q,2),ee=Se[0],m=Se[1],D=(0,_.useState)(!1),je=M()(D,2),J=je[0],ae=je[1],ln=function(b){return function(r,d){m(d?b:!1)}},Le=0,Q=[];i.forEach(function(c){var b=c.id,r=ve()(c,fn),d=Object.keys(r),Z=d.length;Z>Le&&(Le=Z,Q=d)});var Ee={};Q=[].concat(Y()(Q),Y()((t==null||(j=t.child)===null||j===void 0?void 0:j.map(function(c){return Ee[c.id]=c,c.id}))||[])),Q=le().uniq(Q);var an=i.filter(function(c,b){return g?!0:b<4}),N=function(){ae(!1),h.reset()},Pe=function(){var b;return t!=null&&t.childScripts?(0,e.jsx)(ie.Z,{disablePadding:!0,children:t==null||(b=t.childScripts)===null||b===void 0?void 0:b.map(function(r,d){return(0,e.jsx)(se.ZP,{sx:{padding:0,mb:2},secondaryAction:(0,e.jsx)(ne.Z,{edge:"end",sx:{mr:-3.5},"aria-label":r.name,onClick:function(){if(!f.loading){var L=(u==null?void 0:u.control._formValues[s][d])||h.getValues();f.run({url:r.script,isRemote:!0,argument:$()(L)==="object"?JSON.stringify(L):L})}},children:f.loading?(0,e.jsx)(w.Z,{size:24}):(0,e.jsx)(Ie.Z,{})}),children:(0,e.jsx)(I.Z,{variant:"body2",sx:{fontWeight:500},component:"span",onClick:function(){k.history.push("/code?url=".concat(r.script))},children:"".concat(d+1,".").concat(r.name)})},r.name)})}):null};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(V.ZP,{anchor:"bottom",open:J,onClose:function(){return N()},children:[(0,e.jsx)(H.Z,{sx:{pt:1,pb:1,borderBottom:1,borderColor:"divider",boxShadow:function(b){return b.shadows[2]},position:"fixed",width:"100%",bgcolor:"inherit",zIndex:99},children:(0,e.jsxs)(B.Z,{direction:"row",alignItems:"center",children:[(0,e.jsxs)(I.Z,{sx:{flexGrow:1,pl:1},children:[T,"-",t==null?void 0:t.name]}),(0,e.jsx)(W.Z,{color:"primary",onClick:function(){var b=h.getValues();if(b["*JSON*"])try{return u==null||u.setValue(s,JSON.parse(b["*JSON*"])),N()}catch(r){return O.alert({open:!0,message:"JSON \u683C\u5F0F\u9519\u8BEF",type:"error"})}Object.keys(b).forEach(function(r){b[r]===void 0&&(b[r]="")}),C(b),N()},children:"\u4FDD\u5B58"})]})}),(0,e.jsxs)(B.Z,{sx:{pt:10,pl:2,pr:2,height:"60vh",maxHeight:"60vh"},children:[Pe(),Q&&T==="\u65B0\u589E"?(E=Q)===null||E===void 0?void 0:E.map(function(c,b){var r=Ee[c]||{id:"[".concat(b,"].").concat(c),name:c,type:"text"};return(0,e.jsx)(_.Fragment,{children:tn(r,h)},r.id)}):(0,e.jsx)(me.Z,a()({fullWidth:!0,multiline:!0,size:"small",minRows:10,variant:"standard",placeholder:"\u8BF7\u8F93\u5165 JSON \u6570\u7EC4",helperText:(0,e.jsx)("pre",{children:` JSON \u683C\u5F0F\u6570\u7EC4\u793A\u4F8B\u503C
`.concat(JSON.stringify([{key:1,val:1},{key:2,val:2}],null," "))})},h.register("*JSON*")))]})]}),an.map(function(c,b){var r,d=t!=null&&t.primary?t==null?void 0:t.primary.map(function(L){return c[L]||b+1}):[t==null?void 0:t.name,b+1],Z="".concat(t==null?void 0:t.id,"-").concat(b);return!g&&b>4?null:(0,e.jsxs)(xe.Z,{expanded:ee===Z,onChange:ln(Z),children:[(0,e.jsx)(x.Z,{id:Z,expandIcon:(0,e.jsx)(Ze.Z,{}),"aria-controls":"".concat(Z,"-content"),children:(0,e.jsx)(I.Z,{variant:"body2",children:d==null?void 0:d.join("-")})}),(0,e.jsxs)(A.Z,{children:[Pe(),ee===Z&&((r=Q)===null||r===void 0?void 0:r.map(function(L){var Ve=Ee[L]||{type:"text",id:L,name:L};return(0,e.jsx)(_.Fragment,{children:tn(a()(a()({},Ve),{},{formName:"".concat(s,".").concat(b,".").concat(L)}),u)},Ve.id)})),(0,e.jsx)(W.Z,{size:"small",color:"error",sx:{width:"100%"},variant:"contained",onClick:function(){p(b),m(!1)},children:"\u5220\u9664"})]})]},Z)}),i.length>5&&(0,e.jsx)(xe.Z,{expanded:!1,onClick:function(){S(!g)},children:(0,e.jsx)(x.Z,{children:(0,e.jsx)(I.Z,{color:"primary",variant:"body2",sx:{width:1,display:"flex",alignItems:"center",justifyContent:"center"},children:g?(0,e.jsxs)(e.Fragment,{children:["\u6536\u8D77 ",(0,e.jsx)(nn.Z,{})]}):(0,e.jsxs)(e.Fragment,{children:["\u66F4\u591A ",(0,e.jsx)(Ze.Z,{})]})})})}),(0,e.jsx)(xe.Z,{expanded:!1,children:(0,e.jsx)(x.Z,{children:(0,e.jsxs)(B.Z,{spacing:1,sx:{width:1},direction:"row",alignItems:"center",justifyContent:"center",children:[(0,e.jsx)(W.Z,{color:"error",onClick:function(){u==null||u.setValue(s,[])},children:"\u6E05\u7A7A"}),(0,e.jsx)(W.Z,{color:"primary",onClick:function(){h.reset(),R("\u65B0\u589E"),ae(!0)},children:"\u65B0\u589E"}),(0,e.jsx)(W.Z,{color:"warning",onClick:function(){fe()(JSON.stringify(i)),O.alert({open:!0,message:"\u590D\u5236\u6210\u529F",type:"success"})},children:"\u590D\u5236"}),(0,e.jsx)(W.Z,{color:"info",onClick:function(){h.reset(),R("\u5BFC\u5165"),ae(!0)},children:"\u5BFC\u5165"})]})})})]})};function gn(v){var o=v.form,j=v.setting;return j?tn(a()({},j),o):null}var yn=gn,Cn=n(92461),bn=n(67720),Zn=function(o){var j=o.formConfig,E=(0,k.useModel)("@@initialState"),t=E.initialState,u=(0,k.useModel)("api"),s=u.fetchSave,l=t==null?void 0:t.boxdata.usercfgs,i={},C=function(){j.forEach(function(f){var h=t==null?void 0:t.boxdata.datas[f.id],O=h===""||h===void 0?f.val:h;O===null&&(O=void 0);try{i[f.id.replaceAll(".","~")]=f.child?JSON.parse("".concat(O||"[]")):O}catch(F){console.log(F)}})};C();var p=(0,U.cI)({defaultValues:i});return(0,_.useEffect)(function(){i={},C(),p.reset(i)},[t==null?void 0:t.boxdata]),(0,e.jsxs)(Cn.Z,{form:p,noValidate:!0,onSubmit:function(f){var h=[];Object.keys(f).forEach(function(O){var F=O.replaceAll("~","."),X=t==null?void 0:t.boxdata.datas[F],T=f[O];if($()(T)==="object"&&typeof X=="string")try{T=JSON.stringify(T,null," ")}catch(R){T=f[O].join(",")}else typeof f[O]=="boolean"&&(T="".concat(f[O]));h.push({key:F,val:T})}),s.run(h)},autoComplete:"off",children:[(0,e.jsx)(B.Z,{sx:a()({pl:2,pr:2},Number((l==null?void 0:l.app_settings_height)||"0")>0?{maxHeight:"".concat(l==null?void 0:l.app_settings_height,"px"),overflow:"auto"}:{}),spacing:1,children:j.map(function(P){return typeof P.items=="string"&&(P.items=(t==null?void 0:t.boxdata.datas[P.items])||[]),(0,e.jsx)(yn,{form:p,setting:P,itemValue:t==null?void 0:t.boxdata.datas},P.id)})}),(0,e.jsx)(bn.Z,{}),(0,e.jsx)(B.Z,{p:"5px",spacing:2,justifyContent:"flex-end",children:(0,e.jsx)(W.Z,{type:"submit",variant:"text",sx:{width:"max-content",marginLeft:"auto"},children:"\u4FDD\u5B58"})})]})},Sn=Zn,En=n(31085),Pn=["appName"],Dn=function(o){var j,E,t=(0,k.useModel)("api"),u=t.fetchSave,s=(0,U.cI)();return(0,_.useEffect)(function(){if(o.open){var l,i,C={};(l=o.data)===null||l===void 0||l.datas.forEach(function(p){C[p.key.replace(".","*")]=$()(p.val)==="object"?JSON.stringify(p.val):p.val}),s.reset(a()({appName:(i=o.data)===null||i===void 0?void 0:i.name},C))}},[o.open]),(0,e.jsx)(En.Z,{fullScreen:!0,open:!!o.open,title:"".concat(((j=o.data)===null||j===void 0?void 0:j.name)||"\u4F1A\u8BDD\u4FEE\u6539"),onClose:function(){var i;(i=o.onClose)===null||i===void 0||i.call(o)},form:s,loading:u.loading,onSubmit:function(i){var C=i.appName,p=ve()(i,Pn),P=[];Object.keys(p).forEach(function(f){P.push({key:f.replace("*","."),val:p[f]})}),u.run([{key:"@chavy_boxjs_sessions.".concat(o.sessionIndex),val:a()(a()({},o.data),{},{datas:P,name:C})}]).then(function(){var f;(f=o.onClose)===null||f===void 0||f.call(o)})},children:(0,e.jsxs)(B.Z,{spacing:2,children:[(0,e.jsx)(me.Z,a()({fullWidth:!0,size:"small",label:"\u4F1A\u8BDD\u540D\u79F0",variant:"standard",placeholder:"\u4F1A\u8BDD\u540D\u79F0",InputLabelProps:{shrink:!0}},s.register("appName"))),(E=o.data)===null||E===void 0?void 0:E.datas.map(function(l){return(0,e.jsx)(me.Z,a()({fullWidth:!0,size:"small",label:l.key,variant:"standard",placeholder:"\u8BF7\u8F93\u5165",InputLabelProps:{shrink:!0}},s.register(l.key.replace(".","*"))),l.key)})]})})},Mn=Dn,_n=n(5554),On=n(84424),Fn=n(50594),An=n(43329),dn=n(90948),In=n(14948),We=n(90629),Bn=n(74815),Tn=n(90852),Rn=n(40044),Wn=n(8379),un=n.n(Wn),Ln=["children","value","index"],cn=(0,dn.ZP)(In.Z)(function(v){var o=v.theme;return{right:"unset","& .MuiBadge-badge":{transform:"scale(1) translate(2px, -50%)",color:o.palette.common.white}}}),kn=(0,dn.ZP)(I.Z)(function(v){return $e()(v),{right:"unset",whiteSpace:"pre-wrap",wordBreak:"break-word","& h4,h1,h2,h3,p":{padding:0,margin:0}}});function Kn(v){var o=v.children,j=v.value,E=v.index,t=ve()(v,Ln);return(0,e.jsx)("div",a()(a()({role:"tabpanel",hidden:j!==E,id:"simple-tabpanel-".concat(E),"aria-labelledby":"simple-tab-".concat(E)},t),{},{children:j===E&&(0,e.jsx)(H.Z,{sx:{p:3},children:o})}))}function Vn(v){return{id:"simple-tab-".concat(v),"aria-controls":"simple-tabpanel-".concat(v)}}function Un(){var v,o,j,E,t,u,s,l,i,C,p,P,f=(0,k.useModel)("@@initialState"),h=f.initialState,O=(0,k.useParams)(),F=O==null?void 0:O.id,X=(0,_.useState)(),T=M()(X,2),R=T[0],de=T[1],ue=(0,k.useModel)("api"),g=ue.fetchSave,S=ue.fetchRunScript,q=(0,k.useModel)("alert"),Se=h==null?void 0:h.boxdata.datas,ee=(h==null?void 0:h.boxdata.sessions)||[],m=h==null?void 0:h.apps.find(function(r){return r.id===F}),D=ee==null?void 0:ee.filter(function(r){return(r==null?void 0:r.appId)==="".concat(F)}),je=!1,J={id:un()(),appId:F,enable:!0,appName:m==null?void 0:m.name,createTime:new Date,datas:m==null?void 0:m.keys.map(function(r){return{key:r,val:Se==null?void 0:Se[r]}})};D&&!(D!=null&&D.length)&&m!==null&&m!==void 0&&m.keys&&F&&(je=!0);var ae=(D==null?void 0:D.findIndex(function(r){return(r==null?void 0:r.id)===(h==null?void 0:h.boxdata.curSessions["".concat(F)])}))||0;ae>-1&&(J.name=D==null?void 0:D[ae].name);var ln=_.useState(ae>-1?ae:0),Le=M()(ln,2),Q=Le[0],Ee=Le[1],an=function(d){Ee(d)},N=D[Q],Pe={};N==null||N.datas.forEach(function(r){Pe[r.key]=r.val});var c=h==null?void 0:h.boxdata.usercfgs,b=ee==null?void 0:ee.findIndex(function(r){return(r==null?void 0:r.id)===(N==null?void 0:N.id)});return m?(0,e.jsxs)(B.Z,{spacing:1,p:1,children:[(0,e.jsx)(Mn,{data:R==null||(v=R.update)===null||v===void 0?void 0:v.data,open:R==null||(o=R.update)===null||o===void 0?void 0:o.open,value:R==null||(j=R.update)===null||j===void 0?void 0:j.val,sessionIndex:b,onClose:function(){return de(function(d){if(d)return d.update={open:!1},a()({},d)})}}),(0,e.jsxs)(B.Z,{direction:"row",justifyContent:m.script?"space-between":"flex-start",alignItems:"center",children:[(0,e.jsx)(I.Z,{variant:"h6",p:2,component:"span",sx:(0,_n.V$)(c==null?void 0:c.bgimg),onClick:function(){var d,Z,L=m.script||((d=m.scripts)===null||d===void 0||(Z=d[0])===null||Z===void 0?void 0:Z.script)||"";L&&k.history.push("/code?url=".concat(L))},children:m.name}),m.script&&(0,e.jsx)(H.Z,{sx:{position:"relative"},children:(0,e.jsxs)(ne.Z,{edge:"end","aria-label":m.name,sx:{mr:.5},onClick:function(){m.script&&S.run({url:m.script,isRemote:!0})},children:[(0,e.jsx)(Ie.Z,{color:"primary"}),((E=S.fetches[m.script])===null||E===void 0?void 0:E.loading)&&(0,e.jsx)(w.Z,{size:24,sx:{position:"absolute",top:"50%",left:"50%",marginTop:"-12px",marginLeft:"-12px"}})]})})]}),((t=m.descs_html)===null||t===void 0?void 0:t.length)>0&&(0,e.jsx)(We.Z,{children:(0,e.jsxs)(xe.Z,{children:[(0,e.jsx)(x.Z,{sx:{m:0},expandIcon:(0,e.jsx)(Ze.Z,{}),"aria-controls":"panel-content",id:"panel-header",children:(0,e.jsx)(I.Z,{variant:"body2",children:"\u64CD\u4F5C\u63D0\u793A"})}),(0,e.jsx)(A.Z,{children:m.descs_html.map(function(r,d){return(0,e.jsx)(kn,{color:"grey",display:"block",variant:"caption",sx:{mb:0},dangerouslySetInnerHTML:{__html:r}},"html-".concat(d))})})]})}),m.scripts&&((u=m.scripts)===null||u===void 0?void 0:u.length)>0&&(0,e.jsx)(We.Z,{sx:{padding:2,mb:2},elevation:3,children:(0,e.jsxs)(B.Z,{spacing:2,children:[(0,e.jsxs)(B.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[(0,e.jsx)(I.Z,{variant:"body2",children:"\u5E94\u7528\u811A\u672C"}),(0,e.jsx)(cn,{color:"primary",badgeContent:(s=m.scripts)===null||s===void 0?void 0:s.length,sx:{color:function(d){return d.palette.common.white}}})]}),(0,e.jsx)(ie.Z,{disablePadding:!0,children:m.scripts.map(function(r,d){return(0,e.jsx)(se.ZP,{sx:{padding:0,mb:2},secondaryAction:(0,e.jsx)(ne.Z,{edge:"end","aria-label":r.name,onClick:function(){S.loading||S.run({url:r.script,isRemote:!0})},children:S.loading?(0,e.jsx)(w.Z,{size:24}):(0,e.jsx)(Ie.Z,{})}),children:(0,e.jsx)(I.Z,{variant:"body2",sx:{fontWeight:500},component:"span",onClick:function(){k.history.push("/code?url=".concat(r.script))},children:"".concat(d+1,".").concat(r.name)})},r.name)})})]})},"scripts"),m.settings&&((l=m.settings)===null||l===void 0?void 0:l.length)>0&&(0,e.jsx)(We.Z,{sx:{mb:2},elevation:3,children:(0,e.jsxs)(B.Z,{spacing:2,children:[(0,e.jsxs)(B.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",p:2,children:[(0,e.jsx)(I.Z,{variant:"body2",children:"\u5E94\u7528\u8BBE\u7F6E"}),(0,e.jsx)(cn,{color:"primary",badgeContent:(i=m.settings)===null||i===void 0?void 0:i.length,sx:{color:function(d){return d.palette.common.white}}})]}),(C=g.fetches.chavy_boxjs_cur_sessions)!==null&&C!==void 0&&C.loading?null:(0,e.jsx)(Sn,{formConfig:m.settings})]})},"setting"),(m==null||(p=m.keys)===null||p===void 0?void 0:p.length)!==0?(0,e.jsxs)(We.Z,{elevation:3,sx:{mb:2},children:[(0,e.jsx)(H.Z,{sx:{borderBottom:1,borderColor:"divider",px:2,py:1},children:(0,e.jsxs)(B.Z,{direction:"row",spacing:2,children:[(0,e.jsx)(I.Z,{children:"\u5F53\u524D\u4F1A\u8BDD"}),J.name?(0,e.jsxs)(I.Z,{color:"primary",children:["#",J.name]}):null]})}),(0,e.jsx)(H.Z,{sx:a()({p:2},Number((c==null?void 0:c.app_settings_height)||"0")>0?{maxHeight:"".concat(c==null?void 0:c.app_settings_height,"px"),overflow:"auto"}:{}),children:(0,e.jsx)(ie.Z,{disablePadding:!0,children:J==null?void 0:J.datas.map(function(r){return(0,e.jsxs)(se.ZP,{sx:{p:0},children:[(0,e.jsx)(Ce.Z,{primary:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("span",{style:{maxWidth:"85%",display:"inline-block",textOverflow:"ellipsis",overflow:"hidden",height:"100%",verticalAlign:"middle"},children:r.key}),r.val&&(0,e.jsx)(ne.Z,{onClick:function(){fe()($()(r.val)==="object"?JSON.stringify(r.val):r.val),q.alert({open:!0,message:"\u590D\u5236\u6210\u529F",type:"success"})},children:(0,e.jsx)(On.Z,{fontSize:"small"})})]}),primaryTypographyProps:{noWrap:!0,variant:"caption",sx:{fontWeight:"bold"}},secondary:(0,e.jsx)(I.Z,{noWrap:!0,color:"grey",variant:"caption",component:"div",children:($()(r.val)==="object"&&r.val?JSON.stringify(r.val):r.val)||"\u65E0\u6570\u636E"})}),(0,e.jsx)(ne.Z,{onClick:function(){var Z=Y()((J==null?void 0:J.datas)||[]),L=Z.findIndex(function(Ve){return Ve.key===r.key});Z[L].val="",g.run(Z)},children:(0,e.jsx)(Fn.Z,{fontSize:"small"})})]},r.key)})})}),(0,e.jsx)(H.Z,{p:1,sx:{borderTop:1,borderColor:"divider",display:"flex",justifyContent:"flex-end"},children:(0,e.jsx)(W.Z,{color:"error",onClick:function(){if(D){var d=a()({},J);je?d.name="\u4F1A\u8BDD 1":d.name="\u4F1A\u8BDD ".concat(D.length+1),d.id=un()(),h&&g.run([{key:"@chavy_boxjs_sessions.".concat(ee.length),val:a()({},d)}])}},children:"\u514B\u9686"})})]},"curSessionItem"):(0,e.jsx)(e.Fragment,{}),(D==null?void 0:D.length)!==0&&(m==null||(P=m.keys)===null||P===void 0?void 0:P.length)!==0?(0,e.jsxs)(We.Z,{elevation:3,children:[(0,e.jsx)(H.Z,{sx:{borderBottom:1,borderColor:"divider"},children:(0,e.jsx)(Bn.Z,{value:Q,scrollButtons:!0,variant:"scrollable",allowScrollButtonsMobile:!0,"aria-label":"scrollable force tabs example",sx:ye()({},"& .".concat(Tn.Z.scrollButtons),{"&.Mui-disabled":{opacity:.3}}),onChange:function(d,Z){return an(Z)},children:D==null?void 0:D.map(function(r,d){return(0,e.jsx)(Rn.Z,a()({label:(0,e.jsxs)(B.Z,{spacing:1,direction:"row",alignItems:"center",children:[ae===d?(0,e.jsx)(An.Z,{sx:{width:16,height:16}}):null,(0,e.jsxs)(I.Z,{children:[je?"":"".concat(d+1," # "),r.name]})]})},Vn(d)),r.id)})})}),D==null?void 0:D.map(function(r,d){return(0,e.jsx)(Kn,{value:d,index:Q,children:(0,e.jsx)(ie.Z,{disablePadding:!0,sx:a()({},Number((c==null?void 0:c.app_settings_height)||"0")>0?{maxHeight:"".concat(c==null?void 0:c.app_settings_height,"px"),overflow:"auto"}:{}),children:r==null?void 0:r.datas.map(function(Z){return(0,e.jsx)(se.ZP,{sx:{p:0},children:(0,e.jsx)(Ce.Z,{primary:"".concat(Z.key),primaryTypographyProps:{variant:"caption",sx:{fontWeight:"bold"}},secondary:(0,e.jsx)(I.Z,{color:"grey",variant:"caption",noWrap:!0,component:"div",children:($()(Z.val)==="object"?JSON.stringify(Z.val):Z.val)||"\u65E0\u6570\u636E"})})},Z.key)})})},r.id)}),(0,e.jsx)(H.Z,{p:1,sx:{borderTop:1,borderColor:"divider"},children:(0,e.jsxs)(B.Z,{direction:"row",alignItems:"center",justifyContent:"flex-end",children:[!je&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(W.Z,{color:"error",onClick:function(){h&&g.run([{key:"@chavy_boxjs_sessions.".concat(b),val:null}]).then(function(){Ee(0)})},children:"\u5220\u9664"}),(0,e.jsx)(W.Z,{color:"warning",onClick:function(){de({update:{open:!0,data:N,val:Pe}})},children:"\u4FEE\u6539"}),(0,e.jsx)(W.Z,{color:"primary",onClick:function(){!h||!F||g.run([{key:"chavy_boxjs_cur_sessions",val:JSON.stringify(a()(a()({},h==null?void 0:h.boxdata.curSessions),{},ye()({},F,N.id)))}].concat(Y()(N.datas)))},children:"\u5E94\u7528"})]}),(0,e.jsx)(W.Z,{color:"success",onClick:function(){fe()(JSON.stringify(Pe)),q.alert({open:!0,message:"\u590D\u5236\u6210\u529F",type:"success"})},children:"\u590D\u5236"})]})})]}):(0,e.jsx)(e.Fragment,{})]}):"No find App"}}}]);
