"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[371],{86587:function(w,P,n){n.r(P),n.d(P,{default:function(){return _o}});var G=n(5574),O=n.n(G),$=n(13769),k=n.n($),F=n(97857),j=n.n(F),H=n(58291),E=n(22148),J=n(90948),N=n(90629),L=n(86886),B=n(51233),A=n(87357),U=n(69661),Q=n(81458),V=n(15861),X=n(7145),Y=n.n(X),I=n(67294),q=n(98958),Z=n(98169),oo=n(63679),io=n(36963),no=n(9628),t=n(85893),eo=["item","script","moveCard","findCard","data"],to=(0,J.ZP)(N.Z)(function(u){var r=u.theme;return j()(j()({},r.typography.body2),{},{textAlign:"center",color:r.palette.text.secondary,overflow:"hidden",background:"unset",boxShadow:"unset",borderRadius:0})}),h={},W={},ao=function(r){var _,o=r.item,b=r.script,x=r.moveCard,M=r.findCard,C=r.data,S=k()(r,eo),d="".concat(o==null?void 0:o.id,"_").concat(o==null?void 0:o.author),y=(0,E.useModel)("@@initialState"),a=y.initialState,R=(0,E.useModel)("api"),p=R.fetchRunScript,i=R.fetchSave,l=M(d).index,s=(0,q.c)(function(){return{type:"grid",item:{id:d,originalIndex:l},collect:function(e){var f=e.getSourceClientOffset(),m={x:0,y:0};return f&&(m.x=f.x,m.y=f.y),{offset:m,isDragging:e.isDragging()}},end:function(e,f){var m=e.id,T=e.originalIndex,ho=f.didDrop();ho||x(m,T);var mo=C==null?void 0:C.map(function(K){return K==null?void 0:K.id}),Eo=a==null?void 0:a.boxdata.usercfgs;i.run({key:H.Z.userCfgs,val:JSON.stringify(j()(j()({},Eo),{},{favapps:mo}))})}}},[d,l,x]),v=O()(s,2),c=v[0],z=c.isDragging,D=c.offset,lo=v[1],uo=(0,Z.L)(function(){return{accept:"grid",hover:function(e){var f=e.id;if(f!==d){var m=M(d),T=m.index;x(f,T)}}}},[M,x]),vo=O()(uo,2),co=vo[1],fo=z?0:1;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(L.ZP,{item:!0,xs:3,md:2,style:{opacity:fo,transform:"translate(0,0)"},children:(0,t.jsx)(to,{ref:function(e){return lo(co(e))},onClick:function(){var e="".concat(o==null?void 0:o.id);h[e]===void 0&&(h[e]=0),h[e]+=1,W[e]=setTimeout(function(){if(W[e]!==void 0&&clearTimeout(W[e]),h[e]===2){if(h[e]=0,!b)return E.history.push("/app/".concat(e));p.run({url:b,isRemote:!0})}else h[e]===1&&E.history.push("/app/".concat(e));h={}},200)},children:(0,t.jsxs)(B.Z,{spacing:1,justifyContent:"center",alignItems:"center",children:[(0,t.jsxs)(A.Z,{sx:{width:50,height:50,borderRadius:2,overflow:"hidden",position:"relative",boxShadow:function(e){return e.shadows[4]}},children:[(0,t.jsx)(U.Z,{variant:"square",alt:o==null?void 0:o.name,src:o==null?void 0:o.icon,sx:{width:"100%",height:"100%",background:"#ECECEE"}}),((_=p.fetches["".concat(b)])===null||_===void 0?void 0:_.loading)&&(0,t.jsx)(Q.Z,{sx:{position:"absolute",bottom:0,width:"100%"}})]}),(0,t.jsx)(V.Z,{variant:"body2",sx:{fontSize:10,color:a!=null&&a.boxdata.usercfgs.bgimg?"#fff":"unset",width:"100%",fontWeight:"bold",textShadow:a!=null&&a.boxdata.usercfgs.bgimg?"black 0.1em 0.1em 0.2em":"unset"},noWrap:!0,children:o==null?void 0:o.name})]})})},"".concat(o==null?void 0:o.id,"/").concat(o==null?void 0:o.author,"/").concat(o==null?void 0:o.name)),z&&(a==null?void 0:a.isMobile)&&(0,t.jsx)(B.Z,{sx:{zIndex:-1,opacity:.5,position:"fixed",left:D==null?void 0:D.x,top:D==null?void 0:D.y},spacing:1,justifyContent:"center",alignItems:"center",children:(0,t.jsx)(A.Z,{sx:{width:40,height:40,borderRadius:2,overflow:"hidden",position:"relative",boxShadow:function(e){return e.shadows[4]}},children:(0,t.jsx)(U.Z,{variant:"square",alt:o==null?void 0:o.name,src:o==null?void 0:o.icon,sx:{width:"100%",height:"100%"}})})})]})},ro=(0,I.memo)(ao);function so(){var u,r=(0,E.useModel)("@@initialState"),_=r.initialState,o=(0,Z.L)(function(){return{accept:"grid"}}),b=O()(o,2),x=b[1],M=(_==null||(u=_.boxdata)===null||u===void 0?void 0:u.usercfgs.favapps.map(function(i){return _==null?void 0:_.apps.find(function(l){return l.id===i})}).filter(function(i){return!!i}))||[],C=(0,I.useState)(M),S=O()(C,2),d=S[0],y=S[1],a=(0,I.useCallback)(function(i){var l=d.filter(function(s){return"".concat(s==null?void 0:s.id,"_").concat(s==null?void 0:s.author)===i})[0];return{card:l,index:d.indexOf(l)}},[d]),R=(0,I.useCallback)(function(i,l){var s=a(i),v=s.card,c=s.index;y(Y()(d,{$splice:[[c,1],[l,0,v]]}))},[a,d,y]),p=_==null?void 0:_.ui(_.boxdata);return(0,t.jsx)(L.ZP,{ref:x,container:!0,spacing:4,children:d==null?void 0:d.map(function(i,l){var s;p==null||p.loadAppBaseInfo(i);var v=null;if(i!=null&&i.script)v=i==null?void 0:i.script;else if(i!=null&&i.scripts&&i!==null&&i!==void 0&&(s=i.scripts[0])!==null&&s!==void 0&&s.script){var c;v=i==null||(c=i.scripts[0])===null||c===void 0?void 0:c.script}return(0,t.jsx)(ro,{item:i,data:d,script:v,findCard:a,moveCard:R,index:l},"".concat(i==null?void 0:i.id,"-").concat(i==null?void 0:i.author))})})}function _o(){var u=(0,E.useModel)("@@initialState"),r=u.initialState;return(0,t.jsx)(A.Z,{pt:4,component:"div",children:(0,t.jsx)(oo.W,{backend:r!=null&&r.isMobile?no.zr:io.PD,options:{delay:400},children:(0,t.jsx)(so,{})})})}},58291:function(w,P){P.Z={logo:"https://raw.githubusercontent.com/Orz-3/mini/master/Color/box.png",userCfgs:"chavy_boxjs_userCfgs",sessions:"chavy_boxjs_sessions",app_subCaches:"chavy_boxjs_app_subCaches",backups:"chavy_boxjs_backups",cursessions:"chavy_boxjs_cur_sessions",gistCacheKey:"@chavy_boxjs_userCfgs.gist_cache_key",viewkeys:"@chavy_boxjs_userCfgs.viewkeys"}}}]);
