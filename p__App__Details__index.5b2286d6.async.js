"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[35],{32646:function(tn,ie,n){n.d(ie,{k:function(){return k}});var je=n(97857),ae=n.n(je),ge=n(90948),Q=n(45843),ye=n(85893),k=(0,ge.ZP)(function(ne){return(0,ye.jsx)(Q.Z,ae()({focusVisibleClassName:".Mui-focusVisible",disableRipple:!0},ne))})(function(ne){var M=ne.theme;return{width:42,height:26,padding:0,"& .MuiSwitch-switchBase":{padding:0,margin:2,transitionDuration:"300ms","&.Mui-checked":{transform:"translateX(16px)",color:"#fff","& + .MuiSwitch-track":{backgroundColor:M.palette.primary,opacity:1,border:0},"&.Mui-disabled + .MuiSwitch-track":{opacity:.5}},"&.Mui-focusVisible .MuiSwitch-thumb":{color:M.palette.primary,border:"6px solid #fff"},"&.Mui-disabled .MuiSwitch-thumb":{color:M.palette.mode==="light"?M.palette.grey[100]:M.palette.grey[600]},"&.Mui-disabled + .MuiSwitch-track":{opacity:M.palette.mode==="light"?.7:.3}},"& .MuiSwitch-thumb":{boxSizing:"border-box",width:22,height:22},"& .MuiSwitch-track":{borderRadius:26/2,backgroundColor:M.palette.mode==="light"?"#E9E9EA":"#39393D",opacity:1,transition:M.transitions.create(["background-color"],{duration:500})}}})},16961:function(tn,ie,n){var je=n(52677),ae=n.n(je),ge=n(97857),Q=n.n(ge),ye=n(19632),k=n.n(ye),ne=n(5574),M=n.n(ne),He=n(13769),i=n.n(He),Ce=n(33525),se=n(22148),Qe=n(40625),Ge=n(42761),Xe=n(90089),Ye=n(93946),A=n(42293),we=n(10155),Fe=n(78462),de=n(97212),Be=n(59334),ue=n(15861),K=n(83321),Y=n(50657),Te=n(31425),ce=n(50480),I=n(75438),be=n(36872),Re=n(72890),qe=n(93109),w=n(67294),g=n(85893),en=["defaultValue"],nn=(0,w.forwardRef)(function(re,ve){var oe=re.defaultValue,U=i()(re,en),F=w.useState(!1),Le=M()(F,2),z=Le[0],B=Le[1],Ze=(0,w.useState)(oe),he=M()(Ze,2),We=he[0],Ke=he[1],Ee=(0,w.useState)(""),Ue=M()(Ee,2),rn=Ue[0],Ve=Ue[1],D=(0,qe.Z)(rn,{wait:100}),on=(0,se.useModel)("@@initialState"),C=on.initialState,q=[{id:"extra_data_key",name:"\u975E\u8BA2\u9605\u6570\u636E",_id:"extra_data_key@local",keys:(C==null?void 0:C.boxdata.usercfgs.gist_cache_key)||[],descs_html:[],author:"local",repo:"",icons:[]}].concat(k()(((C==null?void 0:C.boxdata.sysapps)||[]).filter(function(u){return u.keys&&!!u.keys.length})));Object.values((C==null?void 0:C.boxdata.appSubCaches)||{}).forEach(function(u){q=[].concat(k()(q),k()(u.apps.filter(function(P){return P.keys&&!!P.keys.length})))}),q=q.filter(function(u){return u.name.indexOf(D)>-1||!D?!0:!!u.keys.find(function(P){return P.indexOf(D)>-1})});var e=C==null?void 0:C.boxdata.datas;(0,w.useImperativeHandle)(ve,function(){return{value:We}}),(0,w.useEffect)(function(){Ke(U.value)},[U.value]);var _e=function(){B(!1),Ve("")},Ne=function(P){var R;Ke(P),(R=U.onChange)===null||R===void 0||R.call(U,{target:{name:U.name,value:P}})};return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(Xe.Z,Q()(Q()({},U),{},{value:We,onChange:function(P){Ne(P.target.value)},size:"small",type:"text",endAdornment:(0,g.jsx)(Ye.Z,{size:"small","aria-label":U.name,onClick:function(){B(!0)},children:(0,g.jsx)(Qe.Z,{fontSize:"small",sx:{color:function(P){return P.palette.primary.main}}})})})),(0,g.jsxs)(Y.Z,{open:z,onClose:function(){return _e()},sx:{mt:15,mb:15,"& .MuiDialog-paper":{width:"100%"}},children:[(0,g.jsx)(A.Z,{position:"static",sx:{background:function(P){return P.palette.primary.main}},children:(0,g.jsx)(we.Z,{children:(0,g.jsxs)(Ce.ol,{children:[(0,g.jsx)(Ce.el,{placeholder:"\u8BF7\u8F93\u5165\u5E94\u7528\u540D\u79F0\u6216\u7F13\u5B58Key",inputProps:{"aria-label":"search"},onChange:function(P){Ve(P.target.value)}}),(0,g.jsx)(Ce.cB,{children:(0,g.jsx)(Ge.Z,{})})]})})}),(0,g.jsx)(Fe.Z,{subheader:(0,g.jsx)("li",{}),sx:{position:"relative",overflow:"auto",minHeight:300,"& ul":{padding:0}},children:(0,g.jsx)(Re.Z,{name:"radio-buttons-group",onChange:function(P,R){Ne(R)},children:q.length>0?q.map(function(u,P){var R,Se,Me="".concat(u.id,"_").concat(u.author,"_").concat(P);return(0,g.jsxs)("li",{style:{width:"100%",boxSizing:"border-box"},children:[(0,g.jsxs)(I.Z,{sx:{borderBottom:"1px solid rgba(0, 0, 0, .125)",mt:0},children:[u==null?void 0:u.name,"\uFF08",u==null||(R=u.keys)===null||R===void 0?void 0:R.length,"\uFF09"]}),u==null||(Se=u.keys)===null||Se===void 0?void 0:Se.map(function(G){return(0,g.jsx)(de.ZP,{sx:{p:0,pl:3,pr:3},children:(0,g.jsx)(Be.Z,{id:Me,primary:(0,g.jsx)(ce.Z,{value:G,control:(0,g.jsx)(be.Z,{}),label:G,sx:{"& .MuiFormControlLabel-label":{width:"80%",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"noWrap"}}}),primaryTypographyProps:{noWrap:!0,variant:"caption",sx:{fontWeight:"bold"}},secondary:(0,g.jsx)(ue.Z,{noWrap:!0,color:"grey",variant:"caption",component:"div",children:(ae()(e==null?void 0:e[G])==="object"&&(e!=null&&e[G])?JSON.stringify(e==null?void 0:e[G]):e==null?void 0:e[G])||"\u65E0\u6570\u636E"})})},"".concat(Me,"-").concat(G))})]},"section-".concat(Me))}):(0,g.jsx)(de.ZP,{sx:{height:290,textAlign:"center"},children:(0,g.jsx)(Be.Z,{primary:"\u672A\u627E\u5230\u76F8\u5173\u7ED3\u679C"})})})}),(0,g.jsxs)(Te.Z,{sx:{borderTop:"1px solid rgba(0, 0, 0, .125)"},children:[(0,g.jsx)(K.Z,{color:"inherit",onClick:function(){return _e()},children:"\u53D6\u6D88"}),(0,g.jsx)(K.Z,{onClick:function(){return _e()},autoFocus:!0,children:"\u786E\u5B9A"})]})]})]})});ie.Z=nn},36208:function(tn,ie,n){n.r(ie),n.d(ie,{default:function(){return In}});var je=n(9783),ae=n.n(je),ge=n(19632),Q=n.n(ge),ye=n(52677),k=n.n(ye),ne=n(5574),M=n.n(ne),He=n(97857),i=n.n(He),Ce=n(13769),se=n.n(Ce),Qe=n(49677),Ge=n.n(Qe),Xe=n(32646),Ye=n(16961),A=n(22148),we=n(60181),Fe=n(23508),de=n(3018),Be=n(74423),ue=n(56815),K=n(94054),Y=n(47312),Te=n(90089),ce=n(50135),I=n(51233),be=n(50480),Re=n(40476),qe=n(69368),w=n(72890),g=n(36872),en=n(10315),nn=n(18972),re=n(78462),ve=n(97212),oe=n(93946),U=n(98456),F=n(15861),Le=n(58826),z=n(87357),B=n(83321),Ze=n(82280),he=n(38895),We=n(22797),Ke=n(20640),Ee=n.n(Ke),Ue=n(96486),rn=n.n(Ue),Ve=n(97458),D=n(67294),on=n(30780),C=n(87536),q={add:"add___mHDQy",picker:"picker___ZxyLG"},e=n(85893),_e=["text"],Ne=["id"];function u(p){var r=p.text,f=se()(p,_e),E=(0,Be.Z)()||{},t=E.focused,c=D.useMemo(function(){return t?r:""},[t]);return(0,e.jsx)(Ve.Z,{type:["top","bottom"],leaveReverse:!0,style:{minHeight:25},children:t?(0,e.jsx)(ue.Z,i()(i()({},f),{},{children:c}),r):null})}var P=(0,D.forwardRef)(function(p,r){var f=p.value,E=p.defaultValue,t=p.name,c=p.onChange,d=(0,D.useState)(E),l=M()(d,2),s=l[0],x=l[1],y={};return y.color=s,(0,D.useImperativeHandle)(r,function(){return{value:f}}),(0,D.useEffect)(function(){x(f)},[f]),(0,e.jsx)(on.AI,i()(i()({},y),{},{className:q.picker,onChangeComplete:function(_){x(_.hex),c==null||c({target:{name:t,value:_.hex}})}}))}),R=function(r,f){r.name=(r.disabled?"\u{1F232} \u624B\u52A8\u586B\u5199-":"")+r.name;var E=r.id.replaceAll(".","~"),t={name:r.formName||E,control:f==null?void 0:f.control,rules:{pattern:r.pattern}};return(0,e.jsxs)(e.Fragment,{children:[(["text","number"].includes(r.type)||!r.type)&&(0,e.jsxs)(K.Z,{size:"small",sx:{width:1},variant:"standard",children:[(0,e.jsx)(Y.Z,{htmlFor:r.id,children:r.name}),(0,e.jsx)(C.Qr,i()(i()({},t),{},{render:function(d){var l=d.field,s=d.formState;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Te.Z,i()({id:r.id,size:"small",type:r.type,disabled:r.disabled,placeholder:r.placeholder},l)),(0,e.jsx)(u,{text:r.desc,error:!!s.errors[l.name]})]})}}))]}),r.type==="textarea"&&!r.child&&(0,e.jsx)(C.Qr,i()(i()({},t),{},{render:function(d){var l=d.field,s=d.formState;return(0,e.jsx)(ce.Z,i()({fullWidth:!0,multiline:!0,id:r.id,size:"small",label:r.name,variant:"standard",rows:6,helperText:r.desc,disabled:r.disabled,placeholder:r.placeholder,error:!!s.errors[l.name]},l))}})),r.child&&(0,e.jsxs)(K.Z,{size:"small",sx:{width:1},variant:"standard",children:[(0,e.jsx)(Y.Z,{htmlFor:r.id,sx:{position:"unset",transform:"unset",mb:2},children:r.name}),(0,e.jsx)(Se,{name:t.name,form:f,setting:r}),(0,e.jsx)(u,{text:r.desc})]}),r.type==="boolean"&&(0,e.jsxs)(I.Z,{children:[(0,e.jsx)(C.Qr,i()(i()({},t),{},{render:function(d){var l=d.field;return(0,e.jsx)(be.Z,{label:r.name,control:(0,e.jsx)(Xe.k,{sx:{m:1},disabled:r.disabled,checked:l.value==="true"||l.value===!0,onChange:function(x){return l.onChange(x.target.checked)}})})}})),(0,e.jsx)(ue.Z,{sx:{minHeight:20},children:r.desc})]}),r.type==="checkboxes"&&(0,e.jsxs)(K.Z,{component:"fieldset",variant:"standard",children:[(0,e.jsx)(Re.Z,{component:"legend",children:r.name}),(0,e.jsx)(C.Qr,i()(i()({},t),{},{render:function(d){var l,s=d.field,x=typeof s.value=="string",y=(x?s.value.split(","):s.value)||[];return(0,e.jsx)(e.Fragment,{children:(l=r.items)===null||l===void 0?void 0:l.map(function(b){return(0,e.jsx)(be.Z,{control:(0,e.jsx)(qe.Z,{checked:y==null?void 0:y.includes(b.key),onChange:function(v){var S=y;v.target.checked?S.push(b.key):S=S.filter(function(T){return T!=b.key}),s.onChange(x?S.join(","):S)}}),label:b.label,disabled:r.disabled},b.key)})})}})),(0,e.jsx)(ue.Z,{sx:{minHeight:20},children:r.desc})]}),["cacheKey","text","textarea","selects","boolean","radios","checkboxes","colorpicker","number"].indexOf(r.type)===-1&&(0,e.jsxs)(K.Z,{size:"small",sx:{width:1},variant:"standard",children:[(0,e.jsx)(Y.Z,{htmlFor:r.id,children:r.name}),(0,e.jsx)(C.Qr,i()(i()({},t),{},{render:function(d){var l=d.field,s=d.formState;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Te.Z,i()({id:r.id,size:"small",type:r.type,disabled:r.disabled,placeholder:r.placeholder},l)),(0,e.jsx)(u,{text:r.desc,error:!!s.errors[l.name]})]})}}))]}),r.type==="radios"&&(0,e.jsxs)(K.Z,{component:"fieldset",variant:"standard",children:[(0,e.jsx)(Re.Z,{component:"legend",children:r.name}),(0,e.jsx)(C.Qr,i()(i()({},t),{},{render:function(d){var l,s=d.field;return(0,e.jsx)(w.Z,i()(i()({},s),{},{children:(l=r.items)===null||l===void 0?void 0:l.map(function(x){return(0,e.jsx)(be.Z,{value:x.key,label:x.label,control:(0,e.jsx)(g.Z,{}),disabled:r.disabled},x.key)})}))}})),(0,e.jsx)(ue.Z,{sx:{minHeight:20},children:r.desc})]}),r.type==="selects"&&(0,e.jsxs)(K.Z,{sx:{m:1},variant:"standard",children:[(0,e.jsx)(Y.Z,{htmlFor:r.id,children:r.name}),(0,e.jsx)(C.Qr,i()(i()({},t),{},{render:function(d){var l,s=d.field;return(0,e.jsx)(en.Z,i()(i()({placeholder:"\u8BF7\u9009\u62E9",sx:{width:"100%"},MenuProps:{sx:{maxHeight:300}}},s),{},{children:(l=r.items)===null||l===void 0?void 0:l.map(function(x,y){return(0,e.jsx)(nn.Z,{value:x.key,children:x.label},"".concat(x.key,"_").concat(y))})}))}})),(0,e.jsx)(u,{text:r.desc})]}),r.type==="cacheKey"&&(0,e.jsx)(K.Z,{size:"small",sx:{width:1},variant:"standard",children:(0,e.jsx)(C.Qr,i()(i()({},t),{},{render:function(d){var l=d.field,s=d.formState;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Y.Z,{htmlFor:r.id,shrink:!!l.value,children:r.name}),(0,e.jsx)(Ye.Z,i()({},l)),(0,e.jsx)(u,{text:r.desc,error:!!s.errors[l.name]})]})}}))}),r.type==="colorpicker"&&(0,e.jsxs)(K.Z,{size:"small",sx:{width:1},variant:"standard",children:[(0,e.jsx)(Y.Z,{htmlFor:r.id,sx:{position:"unset",transform:"unset",mb:2},children:r.name}),(0,e.jsx)(C.Qr,i()(i()({},t),{},{render:function(d){var l=d.field;return(0,e.jsx)(P,{value:l.value,onChange:function(x){return l.onChange(x.target.value)}})}})),(0,e.jsx)(u,{text:r.desc})]})]})},Se=function(r){var f,E,t=r.setting,c=r.form,d=r.name,l=(0,C.Dq)({name:d,control:c==null?void 0:c.control}),s=l.fields,x=l.append,y=l.remove,b=(0,A.useModel)("api"),_=b.fetchRunScript,v=(0,A.useRequest)(function(j){return(0,A.request)(j)},{manual:!0,formatResult:function(o){return o}}),S=(0,C.cI)(),T=(0,A.useModel)("alert"),J=(0,D.useState)(""),me=M()(J,2),W=me[0],De=me[1],$e=(0,D.useState)(!1),ee=M()($e,2),X=ee[0],ke=ee[1],Oe=(0,D.useState)(!1),H=M()(Oe,2),h=H[0],Z=H[1],xe=(0,D.useState)(!1),L=M()(xe,2),te=L[0],Ie=L[1],ze=function(o){return function(a,m){Z(m?o:!1)}},fe=0,V=[];s.forEach(function(j){var o=j.id,a=se()(j,Ne),m=Object.keys(a),O=m.length;O>fe&&(fe=O,V=m)});var Ae={};V=[].concat(Q()(V),Q()((t==null||(f=t.child)===null||f===void 0?void 0:f.map(function(j){return Ae[j.id]=j,j.id}))||[])),V=rn().uniq(V);var N=s.filter(function(j,o){return X?!0:o<4}),le=function(){Ie(!1),S.reset()},pe=function(o){var a;return t!=null&&t.childScripts?(0,e.jsx)(re.Z,{disablePadding:!0,children:t==null||(a=t.childScripts)===null||a===void 0?void 0:a.map(function(m,O){return(0,e.jsx)(ve.ZP,{sx:{padding:0,mb:2},secondaryAction:(0,e.jsxs)(oe.Z,{edge:"end",sx:{mr:-3.5,position:"relative"},"aria-label":m.name,onClick:function(){var Je="const $arguments=".concat(JSON.stringify((c==null?void 0:c.control._formValues[d][O])||S.getValues()),`;
`);v.run(m.script).then(function(An){_.run({script:"".concat(Je).concat(An)})})},children:[(0,e.jsx)(de.Z,{}),_.loading&&(0,e.jsx)(U.Z,{size:24,sx:{position:"absolute",top:"50%",left:"50%",marginTop:"-12px",marginLeft:"-12px"}})]}),children:(0,e.jsx)(F.Z,{variant:"body2",sx:{fontWeight:500},component:"span",onClick:function(){A.history.push("/code?url=".concat(m.script))},children:"".concat(O+1,".").concat(m.name)})},m.name)})}):null};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(Le.ZP,{anchor:"bottom",open:te,onClose:function(){return le()},children:[(0,e.jsx)(z.Z,{sx:{pt:1,pb:1,borderBottom:1,borderColor:"divider",boxShadow:function(o){return o.shadows[2]},position:"fixed",width:"100%",bgcolor:"inherit",zIndex:99},children:(0,e.jsxs)(I.Z,{direction:"row",alignItems:"center",children:[(0,e.jsxs)(F.Z,{sx:{flexGrow:1,pl:1},children:[W,"-",t==null?void 0:t.name]}),(0,e.jsx)(B.Z,{color:"primary",onClick:function(){var o=S.getValues();if(o["*JSON*"])try{return c==null||c.setValue(d,JSON.parse(o["*JSON*"])),le()}catch(a){return T.alert({open:!0,message:"JSON \u683C\u5F0F\u9519\u8BEF",type:"error"})}Object.keys(o).forEach(function(a){o[a]===void 0&&(o[a]="")}),x(o),le()},children:"\u4FDD\u5B58"})]})}),(0,e.jsxs)(I.Z,{sx:{pt:10,pl:2,pr:2,height:"60vh",maxHeight:"60vh"},children:[pe(),V&&W==="\u65B0\u589E"?(E=V)===null||E===void 0?void 0:E.map(function(j,o){var a=Ae[j]||{id:"[".concat(o,"].").concat(j),name:j,type:"text"};return(0,e.jsx)(D.Fragment,{children:R(a,S)},a.id)}):(0,e.jsx)(ce.Z,i()({fullWidth:!0,multiline:!0,size:"small",minRows:10,variant:"standard",placeholder:"\u8BF7\u8F93\u5165 JSON \u6570\u7EC4",helperText:(0,e.jsx)("pre",{children:` JSON \u683C\u5F0F\u6570\u7EC4\u793A\u4F8B\u503C
`.concat(JSON.stringify([{key:1,val:1},{key:2,val:2}],null," "))})},S.register("*JSON*")))]})]}),N.map(function(j,o){var a,m=t!=null&&t.primary?t==null?void 0:t.primary.map(function($){return j[$]||o+1}):[t==null?void 0:t.name,o+1],O="".concat(t==null?void 0:t.id,"-").concat(o);return!X&&o>4?null:(0,e.jsxs)(Ze.Z,{expanded:h===O,onChange:ze(O),children:[(0,e.jsx)(he.Z,{id:O,expandIcon:(0,e.jsx)(Fe.Z,{}),"aria-controls":"".concat(O,"-content"),children:(0,e.jsx)(F.Z,{variant:"body2",children:m==null?void 0:m.join("-")})}),(0,e.jsxs)(We.Z,{children:[pe(o),h===O&&((a=V)===null||a===void 0?void 0:a.map(function($){var Je=Ae[$]||{type:"text",id:$,name:$};return(0,e.jsx)(D.Fragment,{children:R(i()(i()({},Je),{},{formName:"".concat(d,".").concat(o,".").concat($)}),c)},Je.id)})),(0,e.jsx)(B.Z,{size:"small",color:"error",sx:{width:"100%"},variant:"contained",onClick:function(){y(o),Z(!1)},children:"\u5220\u9664"})]})]},O)}),s.length>5&&(0,e.jsx)(Ze.Z,{expanded:!1,onClick:function(){ke(!X)},children:(0,e.jsx)(he.Z,{children:(0,e.jsx)(F.Z,{color:"primary",variant:"body2",sx:{width:1,display:"flex",alignItems:"center",justifyContent:"center"},children:X?(0,e.jsxs)(e.Fragment,{children:["\u6536\u8D77 ",(0,e.jsx)(we.Z,{})]}):(0,e.jsxs)(e.Fragment,{children:["\u66F4\u591A ",(0,e.jsx)(Fe.Z,{})]})})})}),(0,e.jsx)(Ze.Z,{expanded:!1,children:(0,e.jsx)(he.Z,{children:(0,e.jsxs)(I.Z,{spacing:1,sx:{width:1},direction:"row",alignItems:"center",justifyContent:"center",children:[(0,e.jsx)(B.Z,{color:"error",onClick:function(){c==null||c.setValue(d,[])},children:"\u6E05\u7A7A"}),(0,e.jsx)(B.Z,{color:"primary",onClick:function(){S.reset(),De("\u65B0\u589E"),Ie(!0)},children:"\u65B0\u589E"}),(0,e.jsx)(B.Z,{color:"warning",onClick:function(){Ee()(JSON.stringify(s)),T.alert({open:!0,message:"\u590D\u5236\u6210\u529F",type:"success"})},children:"\u590D\u5236"}),(0,e.jsx)(B.Z,{color:"info",onClick:function(){S.reset(),De("\u5BFC\u5165"),Ie(!0)},children:"\u5BFC\u5165"})]})})})]})};function Me(p){var r=p.form,f=p.setting;return f?R(i()({},f),r):null}var G=Me,un=n(92461),cn=n(67720),vn=function(r){var f=r.formConfig,E=(0,A.useModel)("@@initialState"),t=E.initialState,c=(0,A.useModel)("api"),d=c.fetchSave,l={},s=function(){f.forEach(function(b){var _=t==null?void 0:t.boxdata.datas[b.id],v=_===""||_===void 0?b.val:_;v===null&&(v=void 0);try{l[b.id.replaceAll(".","~")]=b.child?JSON.parse("".concat(v||"[]")):v}catch(S){console.log(S)}})};s();var x=(0,C.cI)({defaultValues:l});return(0,D.useEffect)(function(){l={},s(),x.reset(l)},[t==null?void 0:t.boxdata]),(0,e.jsxs)(un.Z,{form:x,noValidate:!0,onSubmit:function(b){var _=[];Object.keys(b).forEach(function(v){var S=v.replaceAll("~","."),T=t==null?void 0:t.boxdata.datas[S],J=b[v];if(k()(J)==="object"&&typeof T=="string")try{J=JSON.stringify(J,null," ")}catch(me){J=b[v].join(",")}else typeof b[v]=="boolean"&&(J="".concat(b[v]));_.push({key:S,val:J})}),d.run(_)},autoComplete:"off",children:[(0,e.jsx)(I.Z,{sx:{pl:2,pr:2},spacing:1,children:f.map(function(y){return(0,e.jsx)(G,{form:x,setting:y,itemValue:t==null?void 0:t.boxdata.datas},y.id)})}),(0,e.jsx)(cn.Z,{}),(0,e.jsx)(I.Z,{p:"5px",spacing:2,justifyContent:"flex-end",children:(0,e.jsx)(B.Z,{type:"submit",variant:"text",sx:{width:"max-content",marginLeft:"auto"},children:"\u4FDD\u5B58"})})]})},hn=vn,mn=n(31085),xn=["appName"],fn=function(r){var f,E,t=(0,A.useModel)("api"),c=t.fetchSave,d=(0,C.cI)();return(0,D.useEffect)(function(){if(r.open){var l,s,x={};(l=r.data)===null||l===void 0||l.datas.forEach(function(y){x[y.key.replace(".","*")]=k()(y.val)==="object"?JSON.stringify(y.val):y.val}),d.reset(i()({appName:(s=r.data)===null||s===void 0?void 0:s.name},x))}},[r.open]),(0,e.jsx)(mn.Z,{fullScreen:!0,open:!!r.open,title:"".concat(((f=r.data)===null||f===void 0?void 0:f.name)||"\u4F1A\u8BDD\u4FEE\u6539"),onClose:function(){var s;(s=r.onClose)===null||s===void 0||s.call(r)},form:d,loading:c.loading,onSubmit:function(s){var x=s.appName,y=se()(s,xn),b=[];Object.keys(y).forEach(function(_){b.push({key:_.replace("*","."),val:y[_]})}),c.run([{key:"@chavy_boxjs_sessions.".concat(r.sessionIndex),val:i()(i()({},r.data),{},{datas:b,name:x})}]).then(function(){var _;(_=r.onClose)===null||_===void 0||_.call(r)})},children:(0,e.jsxs)(I.Z,{spacing:2,children:[(0,e.jsx)(ce.Z,i()({fullWidth:!0,size:"small",label:"\u4F1A\u8BDD\u540D\u79F0",variant:"standard",placeholder:"\u4F1A\u8BDD\u540D\u79F0",InputLabelProps:{shrink:!0}},d.register("appName"))),(E=r.data)===null||E===void 0?void 0:E.datas.map(function(l){return(0,e.jsx)(ce.Z,i()({fullWidth:!0,size:"small",label:l.key,variant:"standard",placeholder:"\u8BF7\u8F93\u5165",InputLabelProps:{shrink:!0}},d.register(l.key.replace(".","*"))),l.key)})]})})},pn=fn,jn=n(5554),gn=n(84424),yn=n(50594),Cn=n(43329),ln=n(90948),bn=n(14948),Pe=n(90629),an=n(59334),Zn=n(74815),En=n(90852),_n=n(40044),Sn=n(8379),sn=n.n(Sn),Mn=["children","value","index"],dn=(0,ln.ZP)(bn.Z)(function(p){var r=p.theme;return{right:"unset","& .MuiBadge-badge":{transform:"scale(1) translate(2px, -50%)",color:r.palette.common.white}}}),Pn=(0,ln.ZP)(F.Z)(function(p){return Ge()(p),{right:"unset",whiteSpace:"pre-wrap",wordBreak:"break-word","& h4,h1,h2,h3,p":{padding:0,margin:0}}});function Dn(p){var r=p.children,f=p.value,E=p.index,t=se()(p,Mn);return(0,e.jsx)("div",i()(i()({role:"tabpanel",hidden:f!==E,id:"simple-tabpanel-".concat(E),"aria-labelledby":"simple-tab-".concat(E)},t),{},{children:f===E&&(0,e.jsx)(z.Z,{sx:{p:3},children:r})}))}function On(p){return{id:"simple-tab-".concat(p),"aria-controls":"simple-tabpanel-".concat(p)}}function In(){var p,r,f,E,t,c,d,l,s,x,y,b,_=(0,A.useModel)("@@initialState"),v=_.initialState,S=(0,A.useParams)(),T=S==null?void 0:S.id,J=(0,D.useState)(),me=M()(J,2),W=me[0],De=me[1],$e=(0,A.useModel)("api"),ee=$e.fetchSave,X=$e.fetchRunScript,ke=(0,A.useModel)("alert"),Oe=v==null?void 0:v.boxdata.datas,H=(v==null?void 0:v.boxdata.sessions)||[],h=v==null?void 0:v.apps.find(function(o){return o.id===T}),Z=H==null?void 0:H.filter(function(o){return(o==null?void 0:o.appId)==="".concat(T)}),xe=!1,L={id:sn()(),appId:T,enable:!0,appName:h==null?void 0:h.name,createTime:new Date,datas:h==null?void 0:h.keys.map(function(o){return{key:o,val:Oe==null?void 0:Oe[o]}})};Z&&!(Z!=null&&Z.length)&&h!==null&&h!==void 0&&h.keys&&T&&(xe=!0);var te=(Z==null?void 0:Z.findIndex(function(o){return(o==null?void 0:o.id)===(v==null?void 0:v.boxdata.curSessions["".concat(T)])}))||0;te>-1&&(L.name=Z==null?void 0:Z[te].name);var Ie=D.useState(te>-1?te:0),ze=M()(Ie,2),fe=ze[0],V=ze[1],Ae=function(a){V(a)},N=Z[fe],le={};N==null||N.datas.forEach(function(o){le[o.key]=o.val});var pe=v==null?void 0:v.boxdata.usercfgs,j=H==null?void 0:H.findIndex(function(o){return(o==null?void 0:o.id)===(N==null?void 0:N.id)});return h?(0,e.jsxs)(I.Z,{spacing:1,p:1,children:[(0,e.jsx)(pn,{data:W==null||(p=W.update)===null||p===void 0?void 0:p.data,open:W==null||(r=W.update)===null||r===void 0?void 0:r.open,value:W==null||(f=W.update)===null||f===void 0?void 0:f.val,sessionIndex:j,onClose:function(){return De(function(a){if(a)return a.update={open:!1},i()({},a)})}}),(0,e.jsxs)(I.Z,{direction:"row",justifyContent:h.script?"space-between":"flex-start",alignItems:"center",children:[(0,e.jsx)(F.Z,{variant:"h6",p:2,component:"span",sx:(0,jn.V$)(pe==null?void 0:pe.bgimg),onClick:function(){var a,m,O=h.script||((a=h.scripts)===null||a===void 0||(m=a[0])===null||m===void 0?void 0:m.script)||"";O&&A.history.push("/code?url=".concat(O))},children:h.name}),h.script&&(0,e.jsx)(z.Z,{sx:{position:"relative"},children:(0,e.jsxs)(oe.Z,{edge:"end","aria-label":h.name,sx:{mr:.5},onClick:function(){h.script&&X.run({url:h.script,isRemote:!0})},children:[(0,e.jsx)(de.Z,{color:"primary"}),((E=X.fetches[h.script])===null||E===void 0?void 0:E.loading)&&(0,e.jsx)(U.Z,{size:24,sx:{position:"absolute",top:"50%",left:"50%",marginTop:"-12px",marginLeft:"-12px"}})]})})]}),((t=h.descs_html)===null||t===void 0?void 0:t.length)>0&&(0,e.jsx)(Pe.Z,{sx:{padding:2,mb:2},elevation:3,children:h.descs_html.map(function(o,a){return(0,e.jsx)(Pn,{color:"grey",display:"block",variant:"caption",sx:{mb:0},dangerouslySetInnerHTML:{__html:o}},"html-".concat(a))})},"html"),((c=h.scripts)===null||c===void 0?void 0:c.length)&&(0,e.jsx)(Pe.Z,{sx:{padding:2,mb:2},elevation:3,children:(0,e.jsxs)(I.Z,{spacing:2,children:[(0,e.jsxs)(I.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[(0,e.jsx)(F.Z,{variant:"body2",children:"\u5E94\u7528\u811A\u672C"}),(0,e.jsx)(dn,{color:"primary",badgeContent:(d=h.scripts)===null||d===void 0?void 0:d.length,sx:{color:function(a){return a.palette.common.white}}})]}),(0,e.jsx)(re.Z,{disablePadding:!0,children:h.scripts.map(function(o,a){var m;return(0,e.jsx)(ve.ZP,{sx:{padding:0,mb:2},secondaryAction:(0,e.jsxs)(oe.Z,{edge:"end",sx:{mr:-3.5,position:"relative"},"aria-label":o.name,onClick:function(){X.run({url:o.script,isRemote:!0})},children:[(0,e.jsx)(de.Z,{}),((m=X.fetches[o.script])===null||m===void 0?void 0:m.loading)&&(0,e.jsx)(U.Z,{size:24,sx:{position:"absolute",top:"50%",left:"50%",marginTop:"-12px",marginLeft:"-12px"}})]}),children:(0,e.jsx)(F.Z,{variant:"body2",sx:{fontWeight:500},component:"span",onClick:function(){A.history.push("/code?url=".concat(o.script))},children:"".concat(a+1,".").concat(o.name)})},o.name)})})]})},"scripts"),((l=h.settings)===null||l===void 0?void 0:l.length)&&(0,e.jsx)(Pe.Z,{sx:{mb:2},elevation:3,children:(0,e.jsxs)(I.Z,{spacing:2,children:[(0,e.jsxs)(I.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",p:2,children:[(0,e.jsx)(F.Z,{variant:"body2",children:"\u5E94\u7528\u8BBE\u7F6E"}),(0,e.jsx)(dn,{color:"primary",badgeContent:(s=h.settings)===null||s===void 0?void 0:s.length,sx:{color:function(a){return a.palette.common.white}}})]}),(x=ee.fetches.chavy_boxjs_cur_sessions)!==null&&x!==void 0&&x.loading?null:(0,e.jsx)(hn,{formConfig:h.settings})]})},"setting"),(h==null||(y=h.keys)===null||y===void 0?void 0:y.length)!==0?(0,e.jsxs)(Pe.Z,{elevation:3,sx:{mb:2},children:[(0,e.jsx)(z.Z,{sx:{borderBottom:1,borderColor:"divider",px:2,py:1},children:(0,e.jsxs)(I.Z,{direction:"row",spacing:2,children:[(0,e.jsx)(F.Z,{children:"\u5F53\u524D\u4F1A\u8BDD"}),L.name?(0,e.jsxs)(F.Z,{color:"primary",children:["#",L.name]}):null]})}),(0,e.jsx)(z.Z,{sx:{p:2},children:(0,e.jsx)(re.Z,{disablePadding:!0,children:L==null?void 0:L.datas.map(function(o){return(0,e.jsxs)(ve.ZP,{sx:{p:0},children:[(0,e.jsx)(an.Z,{primary:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("span",{style:{maxWidth:"85%",display:"inline-block",textOverflow:"ellipsis",overflow:"hidden",height:"100%",verticalAlign:"middle"},children:o.key}),o.val&&(0,e.jsx)(oe.Z,{onClick:function(){Ee()(o.val),ke.alert({open:!0,message:"\u590D\u5236\u6210\u529F",type:"success"})},children:(0,e.jsx)(gn.Z,{fontSize:"small"})})]}),primaryTypographyProps:{noWrap:!0,variant:"caption",sx:{fontWeight:"bold"}},secondary:(0,e.jsx)(F.Z,{noWrap:!0,color:"grey",variant:"caption",component:"div",children:(k()(o.val)==="object"&&o.val?JSON.stringify(o.val):o.val)||"\u65E0\u6570\u636E"})}),(0,e.jsx)(oe.Z,{onClick:function(){var m=Q()((L==null?void 0:L.datas)||[]),O=m.findIndex(function($){return $.key===o.key});m[O].val="",ee.run(m)},children:(0,e.jsx)(yn.Z,{fontSize:"small"})})]},o.key)})})}),(0,e.jsx)(z.Z,{p:1,sx:{borderTop:1,borderColor:"divider",display:"flex",justifyContent:"flex-end"},children:(0,e.jsx)(B.Z,{color:"error",onClick:function(){if(Z){var a=i()({},L);xe?a.name="\u4F1A\u8BDD 1":a.name="\u4F1A\u8BDD ".concat(Z.length+1),a.id=sn()(),v&&ee.run([{key:"@chavy_boxjs_sessions.".concat(H.length),val:i()({},a)}])}},children:"\u514B\u9686"})})]},"curSessionItem"):(0,e.jsx)(e.Fragment,{}),(Z==null?void 0:Z.length)!==0&&(h==null||(b=h.keys)===null||b===void 0?void 0:b.length)!==0?(0,e.jsxs)(Pe.Z,{elevation:3,children:[(0,e.jsx)(z.Z,{sx:{borderBottom:1,borderColor:"divider"},children:(0,e.jsx)(Zn.Z,{value:fe,scrollButtons:!0,variant:"scrollable",allowScrollButtonsMobile:!0,"aria-label":"scrollable force tabs example",sx:ae()({},"& .".concat(En.Z.scrollButtons),{"&.Mui-disabled":{opacity:.3}}),onChange:function(a,m){return Ae(m)},children:Z==null?void 0:Z.map(function(o,a){return(0,e.jsx)(_n.Z,i()({label:(0,e.jsxs)(I.Z,{spacing:1,direction:"row",alignItems:"center",children:[te===a?(0,e.jsx)(Cn.Z,{sx:{width:16,height:16}}):null,(0,e.jsxs)(F.Z,{children:[xe?"":"".concat(a+1," # "),o.name]})]})},On(a)),o.id)})})}),Z==null?void 0:Z.map(function(o,a){return(0,e.jsx)(Dn,{value:a,index:fe,children:(0,e.jsx)(re.Z,{disablePadding:!0,children:o==null?void 0:o.datas.map(function(m){return(0,e.jsx)(ve.ZP,{sx:{p:0},children:(0,e.jsx)(an.Z,{primary:"".concat(m.key),primaryTypographyProps:{variant:"caption",sx:{fontWeight:"bold"}},secondary:(0,e.jsx)(F.Z,{color:"grey",variant:"caption",noWrap:!0,component:"div",children:(k()(m.val)==="object"?JSON.stringify(m.val):m.val)||"\u65E0\u6570\u636E"})})},m.key)})})},o.id)}),(0,e.jsx)(z.Z,{p:1,sx:{borderTop:1,borderColor:"divider"},children:(0,e.jsxs)(I.Z,{direction:"row",alignItems:"center",justifyContent:"flex-end",children:[!xe&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(B.Z,{color:"error",onClick:function(){v&&ee.run([{key:"@chavy_boxjs_sessions.".concat(j),val:null}]).then(function(){V(0)})},children:"\u5220\u9664"}),(0,e.jsx)(B.Z,{color:"warning",onClick:function(){De({update:{open:!0,data:N,val:le}})},children:"\u4FEE\u6539"}),(0,e.jsx)(B.Z,{color:"primary",onClick:function(){!v||!T||ee.run([{key:"chavy_boxjs_cur_sessions",val:JSON.stringify(i()(i()({},v==null?void 0:v.boxdata.curSessions),{},ae()({},T,N.id)))}].concat(Q()(N.datas)))},children:"\u5E94\u7528"})]}),(0,e.jsx)(B.Z,{color:"success",onClick:function(){Ee()(JSON.stringify(le)),ke.alert({open:!0,message:"\u590D\u5236\u6210\u529F",type:"success"})},children:"\u590D\u5236"})]})})]}):(0,e.jsx)(e.Fragment,{})]}):"No find App"}}}]);
